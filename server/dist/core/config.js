"use strict";
// This file handles all the CLI args, parsing them, and outputting a sane obj
Object.defineProperty(exports, "__esModule", { value: true });
const argparse_1 = require("argparse");
const dotenv_1 = require("dotenv");
const utils_1 = require("~/utils");
/**
 * Set this to true while real life tournaments are on going and competitors
 * are cloning this repo. Otherwise keep on false during development so you
 * can easily move between branches and commits without it being fussy.
 */
const UPDATER_ENABLED_BY_DEFAULT = false;
// loads the config from an optional `.env` file
dotenv_1.config();
const parserArgs = [
    [["--port-offset"], { action: "store", dest: "PORT_OFFSET", defaultValue: 0,
            type: "int", help: "port offset for the default port values" }],
    [["--tcp-port"], { action: "store", dest: "TCP_PORT", defaultValue: 3000,
            type: "int", help: "the port that TCP clients should connect through" }],
    [["--http-port"], { action: "store", dest: "HTTP_PORT", defaultValue: 3080,
            type: "int", help: "the port that the web interface should be accessed through" }],
    [["--ws-port"], { action: "store", dest: "WS_PORT", defaultValue: 3088,
            type: "int", help: "the port that WebSocket clients should connect though" }],
    [["--title"], { action: "store", dest: "MAIN_TITLE", defaultValue: "Cerveau",
            help: "the title of this game sever for the web interface" }],
    [["--password"], { action: "store", dest: "AUTH_PASSWORD", defaultValue: "",
            help: "forces clients to send a valid password to be able to play" }],
    [["--profile"], { action: "storeTrue", dest: "RUN_PROFILER",
            help: "run the v8 profilers against threaded game sessions" }],
    [["--log"], { action: "storeTrue", dest: "LOG_TO_FILES",
            help: "store all logged strings to text files in LOGS_DIR/console/" }],
    [["--logs-dir"], { action: "store", dest: "LOGS_DIR", defaultValue: "logs/",
            help: "The directory to store generated logs (e.g. gamelogs) in." }],
    [["--silent"], { action: "storeTrue", dest: "SILENT",
            help: "log will not print anything to the console" }],
    [["--single-threaded"], { action: "storeTrue", dest: "SINGLE_THREADED",
            help: "If game sessions should be ran on the master thread, for easier debugging of game logic" }],
    [["--only-load"], { nargs: "+", dest: "GAME_NAMES_TO_LOAD",
            help: "The names of specific games to [try] to load, to speed up ts-node startup times" }],
    [["--visualizer-url"], { action: "store", dest: "VISUALIZER_URL",
            help: "the base url the a remote visualizer to send clients to",
            // tslint:disable-next-line:no-http-string - because it has to be
            defaultValue: "http://vis.siggame.io/" }],
    [["--arena"], { action: "storeTrue", dest: "ARENA_MODE",
            help: "starts the server in arena mode, where certain functionality is changed", defaultValue: false }],
    [["--print-tcp"], { action: "storeTrue", dest: "PRINT_TCP",
            help: "(debugging) print IO through the TCP socket to the terminal", defaultValue: false }],
    [["--timeout"], { action: "store", dest: "TIMEOUT_TIME",
            help: "(debugging) override for how long clients have before a timeout occurs", defaultValue: true }],
    [["--no-timeout"], { action: "storeFalse", dest: "TIMEOUT_TIME",
            help: "(debugging) clients cannot time out" }],
    [["--no-game-settings"], { action: "storeFalse", dest: "GAME_SETTINGS_ENABLED",
            help: "ignores any requested game settings from clients", defaultValue: true }],
    [["--no-load-gamelogs"], { action: "storeFalse", dest: "LOAD_EXISTING_GAMELOGS",
            help: "gamelogs are not loaded to get the status or view in the web interface", defaultValue: true }],
    [["--no-session-timeouts"], { action: "storeFalse", dest: "SESSION_TIMEOUTS_ENABLED",
            help: "disables sessions timing out, most useful for debugging", defaultValue: true }],
    [["--no-api"], { action: "storeFalse", dest: "API_ENABLED",
            help: "does not run the hooks for the REST API service", defaultValue: true }],
    [["--no-web"], { action: "storeFalse", dest: "WEB_ENABLED",
            help: "does not run the web interface", defaultValue: true }],
    [["--no-updater"], { action: "storeFalse", dest: "UPDATER_ENABLED",
            help: "does not run the update checker", defaultValue: UPDATER_ENABLED_BY_DEFAULT }],
    [["--no-auto-update"], { action: "storeFalse", dest: "AUTO_UPDATE_ENABLED", defaultValue: true,
            help: "the updater will not try to autoUpdate when updates are found" }],
];
const parserArgByDest = new Map();
for (const [, arg] of parserArgs) {
    parserArgByDest.set(arg.dest, arg);
}
const parser = new argparse_1.ArgumentParser({
    addHelp: true,
    description: "Runs the game server with various options for play",
});
const defaults = {};
for (const [names, options] of parserArgs) {
    parser.addArgument(names, options);
    defaults[options.dest] = options.defaultValue;
}
// first two args are `node main.js`, with the full path to each
const parsedArgs = parser.parseArgs(process.argv.slice(2));
// tslint:disable-next-line:no-any
const args = {}; // we will set it so that it becomes a valid
// IArgs in the next loop
for (const key of Object.keys(parsedArgs)) {
    const envValue = process.env[key];
    const commandLineValue = parsedArgs[key];
    // if the command line value is the default value, and an env value was set
    // use the env value, otherwise use the command line value which will be the
    // default/cli value
    let value = commandLineValue === defaults[key] && envValue
        ? utils_1.unStringify(envValue)
        : commandLineValue;
    if (value === null) {
        // We want undefined to be correct for ? types.
        value = undefined;
    }
    const arg = parserArgByDest.get(key);
    if (arg && arg.nargs && !Array.isArray(value)) { // It is not an array, but should be (probably string from dotenv)
        value = value === undefined
            ? []
            : String(value)
                .split(",") // Split on commas to create an array
                .map((str) => str.trim()); // And trim each string of whitespace
    }
    // tslint:disable-next-line:no-any no-unsafe-any - have to set for IArgs
    args[key] = value;
}
// not exposed because this is an easy thing to fuck up everything else with if you change it
args.BASE_DIR = args.BASE_DIR || __dirname;
if (process.env.WORKER_GAME_SESSION_DATA) {
    // hackish, but let's assume if the data is set it is in the correct format.
    // tslint:disable-next-line:no-unsafe-any
    args.WORKER_DATA = JSON.parse(process.env.WORKER_GAME_SESSION_DATA);
}
if (args.RUN_PROFILER) {
    try {
        // tslint:disable-next-line:no-var-requires no-require-imports
        if (!require("v8-profiler")) {
            throw new Error(
            // tslint:disable-next-line:no-multiline-string
            `ERROR: Module 'v8-profiler' not found and is needed for profiling.
Please use 'npm install v8-profiler'.
NOTE: This will require node-gyp to compile its C++ addons.`);
        }
    }
    catch (err) {
        // tslint:disable-next-line no-console
        console.error(err);
        process.exit(1);
    }
}
if (args.ARENA_MODE) {
    args.LOG_TO_FILES = true;
    args.GAME_SETTINGS_ENABLED = false;
    args.WEB_ENABLED = false;
    args.UPDATER_ENABLED = false;
    args.AUTO_UPDATE = false;
}
if (!isNaN(args.PORT_OFFSET)) {
    args.TCP_PORT += args.PORT_OFFSET;
    args.HTTP_PORT += args.PORT_OFFSET;
    args.WS_PORT += args.PORT_OFFSET;
}
/** The current config as set from CLI and the .env file. */
exports.Config = Object.freeze(args);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvcmUvY29uZmlnLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw4RUFBOEU7O0FBRTlFLHVDQUEyRDtBQUMzRCxtQ0FBZ0M7QUFFaEMsbUNBQWdFO0FBRWhFOzs7O0dBSUc7QUFDSCxNQUFNLDBCQUEwQixHQUFHLEtBQUssQ0FBQztBQUV6QyxnREFBZ0Q7QUFDaEQsZUFBTSxFQUFFLENBQUM7QUFtRlQsTUFBTSxVQUFVLEdBR1Y7SUFDRixDQUFDLENBQUMsZUFBZSxDQUFDLEVBQUUsRUFBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsWUFBWSxFQUFFLENBQUM7WUFDdEUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUseUNBQXlDLEVBQUMsQ0FBQztJQUVsRSxDQUFDLENBQUMsWUFBWSxDQUFDLEVBQUUsRUFBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLElBQUk7WUFDbkUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsa0RBQWtELEVBQUMsQ0FBQztJQUUzRSxDQUFDLENBQUMsYUFBYSxDQUFDLEVBQUUsRUFBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLElBQUk7WUFDckUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsNERBQTRELEVBQUMsQ0FBQztJQUVyRixDQUFDLENBQUMsV0FBVyxDQUFDLEVBQUUsRUFBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLElBQUk7WUFDakUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsdURBQXVELEVBQUMsQ0FBQztJQUVoRixDQUFDLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUks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QUFLLENBQUM7SUFDN0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7Q0FDNUI7QUFFRCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRTtJQUMxQixJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDbEMsSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQ25DLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztDQUNwQztBQUVELDREQUE0RDtBQUMvQyxRQUFBLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhpcyBmaWxlIGhhbmRsZXMgYWxsIHRoZSBDTEkgYXJncywgcGFyc2luZyB0aGVtLCBhbmQgb3V0cHV0dGluZyBhIHNhbmUgb2JqXG5cbmltcG9ydCB7IEFyZ3VtZW50T3B0aW9ucywgQXJndW1lbnRQYXJzZXIgfSBmcm9tIFwiYXJncGFyc2VcIjtcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gXCJkb3RlbnZcIjtcbmltcG9ydCB7IElXb3JrZXJHYW1lU2Vzc2lvbkRhdGEgfSBmcm9tIFwifi9jb3JlL3NlcnZlci93b3JrZXJcIjtcbmltcG9ydCB7IEltbXV0YWJsZSwgVW5rbm93bk9iamVjdCwgdW5TdHJpbmdpZnkgfSBmcm9tIFwifi91dGlsc1wiO1xuXG4vKipcbiAqIFNldCB0aGlzIHRvIHRydWUgd2hpbGUgcmVhbCBsaWZlIHRvdXJuYW1lbnRzIGFyZSBvbiBnb2luZyBhbmQgY29tcGV0aXRvcnNcbiAqIGFyZSBjbG9uaW5nIHRoaXMgcmVwby4gT3RoZXJ3aXNlIGtlZXAgb24gZmFsc2UgZHVyaW5nIGRldmVsb3BtZW50IHNvIHlvdVxuICogY2FuIGVhc2lseSBtb3ZlIGJldHdlZW4gYnJhbmNoZXMgYW5kIGNvbW1pdHMgd2l0aG91dCBpdCBiZWluZyBmdXNzeS5cbiAqL1xuY29uc3QgVVBEQVRFUl9FTkFCTEVEX0JZX0RFRkFVTFQgPSBmYWxzZTtcblxuLy8gbG9hZHMgdGhlIGNvbmZpZyBmcm9tIGFuIG9wdGlvbmFsIGAuZW52YCBmaWxlXG5jb25maWcoKTtcblxuLyoqIFRoZSBzaGFwZSBvZiBjb25maWcgdmFyaWFibGVzICovXG5leHBvcnQgaW50ZXJmYWNlIElBcmdzIHtcbiAgICAvKiogcG9ydCBvZmZzZXQgZm9yIHRoZSBkZWZhdWx0IHBvcnQgdmFsdWVzICovXG4gICAgUE9SVF9PRkZTRVQ6IG51bWJlcjtcblxuICAgIC8qKiB0aGUgcG9ydCB0aGF0IFRDUCBjbGllbnRzIHNob3VsZCBjb25uZWN0IHRocm91Z2ggKi9cbiAgICBUQ1BfUE9SVDogbnVtYmVyO1xuXG4gICAgLyoqIHRoZSBwb3J0IHRoYXQgdGhlIHdlYiBpbnRlcmZhY2Ugc2hvdWxkIGJlIGFjY2Vzc2VkIHRocm91Z2ggKi9cbiAgICBIVFRQX1BPUlQ6IG51bWJlcjtcblxuICAgIC8qKiB0aGUgcG9ydCB0aGF0IFdlYlNvY2tldCBjbGllbnRzIHNob3VsZCBjb25uZWN0IHRob3VnaCAqL1xuICAgIFdTX1BPUlQ6IG51bWJlcjtcblxuICAgIC8qKiB0aGUgdGl0bGUgb2YgdGhpcyBnYW1lIHNldmVyIGZvciB0aGUgd2ViIGludGVyZmFjZSAqL1xuICAgIE1BSU5fVElUTEU/OiBzdHJpbmc7XG5cbiAgICAvKiogZm9yY2VzIGNsaWVudHMgdG8gc2VuZCBhIHBhc3N3b3JkICovXG4gICAgQVVUSF9QQVNTV09SRD86IHN0cmluZztcblxuICAgIC8qKiBydW4gdGhlIHY4IHByb2ZpbGVycyBhZ2FpbnN0IHRocmVhZGVkIGdhbWUgc2Vzc2lvbnMgKi9cbiAgICBSVU5fUFJPRklMRVI6IGJvb2xlYW47XG5cbiAgICAvKiogc3RvcmUgYWxsIGxvZ2dlZCBjb25zb2xlIHN0cmluZ3MgdG8gdGV4dCBmaWxlcyBpbiBMT0dTX0RJUiAqL1xuICAgIExPR19UT19GSUxFUzogYm9vbGVhbjtcblxuICAgIC8qKiBUaGUgZGlyZWN0b3J5IHRvIHN0b3JlIGdlbmVyYXRlZCBsb2dzIChlLmcuIGdhbWVsb2dzKSBpbi4gKi9cbiAgICBMT0dTX0RJUjogc3RyaW5nO1xuXG4gICAgLyoqIFRoZSB3aW5zdG9uIGxvZ2dlciB3aWxsIG5vdCBwcmludCBhbnl0aGluZyB0byB0aGUgY29uc29sZSAqL1xuICAgIFNJTEVOVDogYm9vbGVhbjtcblxuICAgIC8qKiB0aGUgYmFzZSB1cmwgdGhlIGEgcmVtb3RlIHZpc3VhbGl6ZXIgdG8gc2VuZCBjbGllbnRzIHRvICovXG4gICAgVklTVUFMSVpFUl9VUkw6IHN0cmluZztcblxuICAgIC8qKiBzdGFydHMgdGhlIHNlcnZlciBpbiBhcmVuYSBtb2RlLCB3aGVyZSBjZXJ0YWluIGZ1bmN0aW9uYWxpdHkgaXMgY2hhbmdlZCAqL1xuICAgIEFSRU5BX01PREU6IGJvb2xlYW47XG5cbiAgICAvKiogKGRlYnVnZ2luZykgcHJpbnQgSU8gdGhyb3VnaCB0aGUgVENQIHNvY2tldCB0byB0aGUgdGVybWluYWwgKi9cbiAgICBQUklOVF9UQ1A6IGJvb2xlYW47XG5cbiAgICAvKiogKGRlYnVnZ2luZykgb3ZlcnJpZGUgZm9yIGhvdyBsb25nIGNsaWVudHMgaGF2ZSBiZWZvcmUgYSB0aW1lb3V0IG9jY3VycyAqL1xuICAgIFRJTUVPVVRfVElNRTogbnVtYmVyIHwgZmFsc2U7XG5cbiAgICAvKiogaWYgdGhlIGdhbWUgc2V0dGluZ3MgYXJlIGVuYWJsZWQgKi9cbiAgICBHQU1FX1NFVFRJTkdTX0VOQUJMRUQ6IGJvb2xlYW47XG5cbiAgICAvKiogVGhlIG5hbWVzIG9mIHNwZWNpZmljIGdhbWVzIHRvIFt0cnldIHRvIGxvYWQsIHRvIHNwZWVkIHVwIHRzLW5vZGUgc3RhcnR1cCB0aW1lcyAqL1xuICAgIEdBTUVfTkFNRVNfVE9fTE9BRDogSW1tdXRhYmxlPHN0cmluZ1tdPjtcblxuICAgIC8qKiBzaG91bGQgZXhpc3RpbmcgZ2FtZWxvZ3MgYmUgbG9hZGVkIGZyb20gdGhlIGRpc2sgdG8gdGhlIHdlYiBpbnRlcmZhY2UvYXBpICovXG4gICAgTE9BRF9FWElTVElOR19HQU1FTE9HUzogYm9vbGVhbjtcblxuICAgIC8qKiBpZiB0aGUgYXBpIGlzIGVuYWJsZWQgKi9cbiAgICBBUElfRU5BQkxFRDogYm9vbGVhbjtcblxuICAgIC8qKiBpZiB0aGUgd2ViIGludGVyZmFjZSBpcyBlbmFibGVkICovXG4gICAgV0VCX0VOQUJMRUQ6IGJvb2xlYW47XG5cbiAgICAvKiogaWYgdGhlIHVwZGF0ZSBjaGVja2VyIGlzIGVuYWJsZWQgKi9cbiAgICBVUERBVEVSX0VOQUJMRUQ6IGJvb2xlYW47XG5cbiAgICAvKiogaWYgdGhlIHVwZGF0ZXIgc2hvdWxkIHRyeSB0byBhdXRvIHVwZGF0ZSB3aGVuIHVwZGF0ZXMgYXJlIGZvdW5kICovXG4gICAgQVVUT19VUERBVEVfRU5BQkxFRDogYm9vbGVhbjtcblxuICAgIC8qKiBpZiB0aGUgdXBkYXRlciB3aWxsIG5vdCB0cnkgdG8gYXV0byB1cGRhdGUgd2hlbiB1cGRhdGVzIGFyZSBmb3VuZCAqL1xuICAgIEFVVE9fVVBEQVRFOiBib29sZWFuO1xuXG4gICAgLyoqIGlmIHRoZSBnYW1lIHNlcnZlciBzaG91bGQgcnVuIGluIHNpbmdsZSB0aHJlYWRlZCBtb2RlIChlYXNpZXIgdG8gZGVidWcpICovXG4gICAgU0lOR0xFX1RIUkVBREVEOiBib29sZWFuO1xuXG4gICAgLyoqIFRoZSBiYXNlIGRpcmVjdG9yeSB0byBpbmNsdWRlIGZpbGVzIGZyb20gKi9cbiAgICBCQVNFX0RJUjogc3RyaW5nO1xuXG4gICAgLyoqIElmIHNlc3Npb25zIHNob3VsZCB0aW1lIG91dCwgdG8gcHJldmVudCB6b21iaWUgcHJvY2Vzc2VzICovXG4gICAgU0VTU0lPTl9USU1FT1VUU19FTkFCTEVEOiBib29sZWFuO1xuXG4gICAgLyoqIFRoZSBjb25maWcgZm9yIHdvcmtlciB0aHJlYWRzLCBpZiB0aGlzIGlzIGEgd29ya2VyIHRocmVhZCwgdW5kZWZpbmVkIGlmIG1hc3RlciB0aHJlYWQgKi9cbiAgICBXT1JLRVJfREFUQT86IEltbXV0YWJsZTxJV29ya2VyR2FtZVNlc3Npb25EYXRhPjtcbn1cblxuY29uc3QgcGFyc2VyQXJnczogQXJyYXk8W3N0cmluZ1tdLCBBcmd1bWVudE9wdGlvbnMgJiB7XG4gICAgLyoqIGRlc3RpbmF0aW9uIGtleSBmb3IgYXJndW1lbnQsIG11c3QgYmUgYSB2YWxpZCBrZXkgb2YgdGhlIElBcmdzIHR5cGUgKi9cbiAgICBkZXN0OiBrZXlvZiBJQXJncztcbn1dPiA9IFtcbiAgICBbW1wiLS1wb3J0LW9mZnNldFwiXSwge2FjdGlvbjogXCJzdG9yZVwiLCBkZXN0OiBcIlBPUlRfT0ZGU0VUXCIsIGRlZmF1bHRWYWx1ZTogMCxcbiAgICAgICAgdHlwZTogXCJpbnRcIiwgaGVscDogXCJwb3J0IG9mZnNldCBmb3IgdGhlIGRlZmF1bHQgcG9ydCB2YWx1ZXNcIn1dLFxuXG4gICAgW1tcIi0tdGNwLXBvcnRcIl0sIHthY3Rpb246IFwic3RvcmVcIiwgZGVzdDogXCJUQ1BfUE9SVFwiLCBkZWZhdWx0VmFsdWU6IDMwMDAsXG4gICAgICAgIHR5cGU6IFwiaW50XCIsIGhlbHA6IFwidGhlIHBvcnQgdGhhdCBUQ1AgY2xpZW50cyBzaG91bGQgY29ubmVjdCB0aHJvdWdoXCJ9XSxcblxuICAgIFtbXCItLWh0dHAtcG9ydFwiXSwge2FjdGlvbjogXCJzdG9yZVwiLCBkZXN0OiBcIkhUVFBfUE9SVFwiLCBkZWZhdWx0VmFsdWU6IDMwODAsXG4gICAgICAgIHR5cGU6IFwiaW50XCIsIGhlbHA6IFwidGhlIHBvcnQgdGhhdCB0aGUgd2ViIGludGVyZmFjZSBzaG91bGQgYmUgYWNjZXNzZWQgdGhyb3VnaFwifV0sXG5cbiAgICBbW1wiLS13cy1wb3J0XCJdLCB7YWN0aW9uOiBcInN0b3JlXCIsIGRlc3Q6IFwiV1NfUE9SVFwiLCBkZWZhdWx0VmFsdWU6IDMwODgsXG4gICAgICAgIHR5cGU6IFwiaW50XCIsIGhlbHA6IFwidGhlIHBvcnQgdGhhdCBXZWJTb2NrZXQgY2xpZW50cyBzaG91bGQgY29ubmVjdCB0aG91Z2hcIn1dLFxuXG4gICAgW1tcIi0tdGl0bGVcIl0sIHthY3Rpb246IFwic3RvcmVcIiwgZGVzdDogXCJNQUlOX1RJVExFXCIsIGRlZmF1bHRWYWx1ZTogXCJDZXJ2ZWF1XCIsXG4gICAgICAgIGhlbHA6IFwidGhlIHRpdGxlIG9mIHRoaXMgZ2FtZSBzZXZlciBmb3IgdGhlIHdlYiBpbnRlcmZhY2VcIn1dLFxuXG4gICAgW1tcIi0tcGFzc3dvcmRcIl0sIHthY3Rpb246IFwic3RvcmVcIiwgZGVzdDogXCJBVVRIX1BBU1NXT1JEXCIsIGRlZmF1bHRWYWx1ZTogXCJcIixcbiAgICAgICAgaGVscDogXCJmb3JjZXMgY2xpZW50cyB0byBzZW5kIGEgdmFsaWQgcGFzc3dvcmQgdG8gYmUgYWJsZSB0byBwbGF5XCJ9XSxcblxuICAgIFtbXCItLXByb2ZpbGVcIl0sIHthY3Rpb246IFwic3RvcmVUcnVlXCIsIGRlc3Q6IFwiUlVOX1BST0ZJTEVSXCIsXG4gICAgICAgIGhlbHA6IFwicnVuIHRoZSB2OCBwcm9maWxlcnMgYWdhaW5zdCB0aHJlYWRlZCBnYW1lIHNlc3Npb25zXCJ9XSxcblxuICAgIFtbXCItLWxvZ1wiXSwge2FjdGlvbjogXCJzdG9yZVRydWVcIiwgZGVzdDogXCJMT0dfVE9fRklMRVNcIixcbiAgICAgICAgaGVscDogXCJzdG9yZSBhbGwgbG9nZ2VkIHN0cmluZ3MgdG8gdGV4dCBmaWxlcyBpbiBMT0dTX0RJUi9jb25zb2xlL1wifV0sXG5cbiAgICBbW1wiLS1sb2dzLWRpclwiXSwge2FjdGlvbjogXCJzdG9yZVwiLCBkZXN0OiBcIkxPR1NfRElSXCIsIGRlZmF1bHRWYWx1ZTogXCJsb2dzL1wiLFxuICAgICAgICBoZWxwOiBcIlRoZSBkaXJlY3RvcnkgdG8gc3RvcmUgZ2VuZXJhdGVkIGxvZ3MgKGUuZy4gZ2FtZWxvZ3MpIGluLlwifV0sXG5cbiAgICBbW1wiLS1zaWxlbnRcIl0sIHthY3Rpb246IFwic3RvcmVUcnVlXCIsIGRlc3Q6IFwiU0lMRU5UXCIsXG4gICAgICAgIGhlbHA6IFwibG9nIHdpbGwgbm90IHByaW50IGFueXRoaW5nIHRvIHRoZSBjb25zb2xlXCJ9XSxcblxuICAgIFtbXCItLXNpbmdsZS10aHJlYWRlZFwiXSwge2FjdGlvbjogXCJzdG9yZVRydWVcIiwgZGVzdDogXCJTSU5HTEVfVEhSRUFERURcIixcbiAgICAgICAgaGVscDogXCJJZiBnYW1lIHNlc3Npb25zIHNob3VsZCBiZSByYW4gb24gdGhlIG1hc3RlciB0aHJlYWQsIGZvciBlYXNpZXIgZGVidWdnaW5nIG9mIGdhbWUgbG9naWNcIn1dLFxuXG4gICAgW1tcIi0tb25seS1sb2FkXCJdLCB7bmFyZ3M6IFwiK1wiLCBkZXN0OiBcIkdBTUVfTkFNRVNfVE9fTE9BRFwiLFxuICAgICAgICBoZWxwOiBcIlRoZSBuYW1lcyBvZiBzcGVjaWZpYyBnYW1lcyB0byBbdHJ5XSB0byBsb2FkLCB0byBzcGVlZCB1cCB0cy1ub2RlIHN0YXJ0dXAgdGltZXNcIn1dLFxuXG4gICAgW1tcIi0tdmlzdWFsaXplci11cmxcIl0sIHthY3Rpb246IFwic3RvcmVcIiwgZGVzdDogXCJWSVNVQUxJWkVSX1VSTFwiLFxuICAgICAgICBoZWxwOiBcInRoZSBiYXNlIHVybCB0aGUgYSByZW1vdGUgdmlzdWFsaXplciB0byBzZW5kIGNsaWVudHMgdG9cIixcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWh0dHAtc3RyaW5nIC0gYmVjYXVzZSBpdCBoYXMgdG8gYmVcbiAgICAgICAgZGVmYXVsdFZhbHVlOiBcImh0dHA6Ly92aXMuc2lnZ2FtZS5pby9cIn1dLFxuXG4gICAgW1tcIi0tYXJlbmFcIl0sIHthY3Rpb246IFwic3RvcmVUcnVlXCIsIGRlc3Q6IFwiQVJFTkFfTU9ERVwiLFxuICAgICAgICBoZWxwOiBcInN0YXJ0cyB0aGUgc2VydmVyIGluIGFyZW5hIG1vZGUsIHdoZXJlIGNlcnRhaW4gZnVuY3Rpb25hbGl0eSBpcyBjaGFuZ2VkXCIsIGRlZmF1bHRWYWx1ZTogZmFsc2V9XSxcblxuICAgIFtbXCItLXByaW50LXRjcFwiXSwge2FjdGlvbjogXCJzdG9yZVRydWVcIiwgZGVzdDogXCJQUklOVF9UQ1BcIixcbiAgICAgICAgaGVscDogXCIoZGVidWdnaW5nKSBwcmludCBJTyB0aHJvdWdoIHRoZSBUQ1Agc29ja2V0IHRvIHRoZSB0ZXJtaW5hbFwiLCBkZWZhdWx0VmFsdWU6IGZhbHNlfV0sXG5cbiAgICBbW1wiLS10aW1lb3V0XCJdLCB7YWN0aW9uOiBcInN0b3JlXCIsIGRlc3Q6IFwiVElNRU9VVF9USU1FXCIsXG4gICAgICAgIGhlbHA6IFwiKGRlYnVnZ2luZykgb3ZlcnJpZGUgZm9yIGhvdyBsb25nIGNsaWVudHMgaGF2ZSBiZWZvcmUgYSB0aW1lb3V0IG9jY3Vyc1wiLCBkZWZhdWx0VmFsdWU6IHRydWV9XSxcblxuICAgIFtbXCItLW5vLXRpbWVvdXRcIl0sIHthY3Rpb246IFwic3RvcmVGYWxzZVwiLCBkZXN0OiBcIlRJTUVPVVRfVElNRVwiLFxuICAgICAgICBoZWxwOiBcIihkZWJ1Z2dpbmcpIGNsaWVudHMgY2Fubm90IHRpbWUgb3V0XCJ9XSxcblxuICAgIFtbXCItLW5vLWdhbWUtc2V0dGluZ3NcIl0sIHthY3Rpb246IFwic3RvcmVGYWxzZVwiLCBkZXN0OiBcIkdBTUVfU0VUVElOR1NfRU5BQkxFRFwiLFxuICAgICAgICBoZWxwOiBcImlnbm9yZXMgYW55IHJlcXVlc3RlZCBnYW1lIHNldHRpbmdzIGZyb20gY2xpZW50c1wiLCBkZWZhdWx0VmFsdWU6IHRydWV9XSxcblxuICAgIFtbXCItLW5vLWxvYWQtZ2FtZWxvZ3NcIl0sIHthY3Rpb246IFwic3RvcmVGYWxzZVwiLCBkZXN0OiBcIkxPQURfRVhJU1RJTkdfR0FNRUxPR1NcIixcbiAgICAgICAgaGVscDogXCJnYW1lbG9ncyBhcmUgbm90IGxvYWRlZCB0byBnZXQgdGhlIHN0YXR1cyBvciB2aWV3IGluIHRoZSB3ZWIgaW50ZXJmYWNlXCIsIGRlZmF1bHRWYWx1ZTogdHJ1ZX1dLFxuXG4gICAgW1tcIi0tbm8tc2Vzc2lvbi10aW1lb3V0c1wiXSwge2FjdGlvbjogXCJzdG9yZUZhbHNlXCIsIGRlc3Q6IFwiU0VTU0lPTl9USU1FT1VUU19FTkFCTEVEXCIsXG4gICAgICAgIGhlbHA6IFwiZGlzYWJsZXMgc2Vzc2lvbnMgdGltaW5nIG91dCwgbW9zdCB1c2VmdWwgZm9yIGRlYnVnZ2luZ1wiLCBkZWZhdWx0VmFsdWU6IHRydWV9XSxcblxuICAgIFtbXCItLW5vLWFwaVwiXSwge2FjdGlvbjogXCJzdG9yZUZhbHNlXCIsIGRlc3Q6IFwiQVBJX0VOQUJMRURcIixcbiAgICAgICAgaGVscDogXCJkb2VzIG5vdCBydW4gdGhlIGhvb2tzIGZvciB0aGUgUkVTVCBBUEkgc2VydmljZVwiLCBkZWZhdWx0VmFsdWU6IHRydWV9XSxcblxuICAgIFtbXCItLW5vLXdlYlwiXSwge2FjdGlvbjogXCJzdG9yZUZhbHNlXCIsIGRlc3Q6IFwiV0VCX0VOQUJMRURcIixcbiAgICAgICAgaGVscDogXCJkb2VzIG5vdCBydW4gdGhlIHdlYiBpbnRlcmZhY2VcIiwgZGVmYXVsdFZhbHVlOiB0cnVlfV0sXG5cbiAgICBbW1wiLS1uby11cGRhdGVyXCJdLCB7YWN0aW9uOiBcInN0b3JlRmFsc2VcIiwgZGVzdDogXCJVUERBVEVSX0VOQUJMRURcIixcbiAgICAgICAgaGVscDogXCJkb2VzIG5vdCBydW4gdGhlIHVwZGF0ZSBjaGVja2VyXCIsIGRlZmF1bHRWYWx1ZTogVVBEQVRFUl9FTkFCTEVEX0JZX0RFRkFVTFR9XSxcblxuICAgIFtbXCItLW5vLWF1dG8tdXBkYXRlXCJdLCB7YWN0aW9uOiBcInN0b3JlRmFsc2VcIiwgZGVzdDogXCJBVVRPX1VQREFURV9FTkFCTEVEXCIsIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICAgICAgaGVscDogXCJ0aGUgdXBkYXRlciB3aWxsIG5vdCB0cnkgdG8gYXV0b1VwZGF0ZSB3aGVuIHVwZGF0ZXMgYXJlIGZvdW5kXCJ9XSxcbl07XG5cbmNvbnN0IHBhcnNlckFyZ0J5RGVzdCA9IG5ldyBNYXA8c3RyaW5nLCBBcmd1bWVudE9wdGlvbnM+KCk7XG5mb3IgKGNvbnN0IFssIGFyZ10gb2YgcGFyc2VyQXJncykge1xuICAgIHBhcnNlckFyZ0J5RGVzdC5zZXQoYXJnLmRlc3QsIGFyZyk7XG59XG5cbmNvbnN0IHBhcnNlciA9IG5ldyBBcmd1bWVudFBhcnNlcih7XG4gICAgYWRkSGVscDogdHJ1ZSxcbiAgICBkZXNjcmlwdGlvbjogXCJSdW5zIHRoZSBnYW1lIHNlcnZlciB3aXRoIHZhcmlvdXMgb3B0aW9ucyBmb3IgcGxheVwiLFxufSk7XG5cbmNvbnN0IGRlZmF1bHRzOiBVbmtub3duT2JqZWN0ID0ge307XG5mb3IgKGNvbnN0IFtuYW1lcywgb3B0aW9uc10gb2YgcGFyc2VyQXJncykge1xuICAgIHBhcnNlci5hZGRBcmd1bWVudChuYW1lcywgb3B0aW9ucyk7XG4gICAgZGVmYXVsdHNbb3B0aW9ucy5kZXN0XSA9IG9wdGlvbnMuZGVmYXVsdFZhbHVlIGFzIHVua25vd247XG59XG5cbi8vIGZpcnN0IHR3byBhcmdzIGFyZSBgbm9kZSBtYWluLmpzYCwgd2l0aCB0aGUgZnVsbCBwYXRoIHRvIGVhY2hcbmNvbnN0IHBhcnNlZEFyZ3MgPSBwYXJzZXIucGFyc2VBcmdzKHByb2Nlc3MuYXJndi5zbGljZSgyKSkgYXMgVW5rbm93bk9iamVjdDtcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcbmNvbnN0IGFyZ3M6IElBcmdzID0ge30gYXMgYW55OyAvLyB3ZSB3aWxsIHNldCBpdCBzbyB0aGF0IGl0IGJlY29tZXMgYSB2YWxpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElBcmdzIGluIHRoZSBuZXh0IGxvb3BcblxuZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMocGFyc2VkQXJncykpIHtcbiAgICBjb25zdCBlbnZWYWx1ZSA9IHByb2Nlc3MuZW52W2tleV07XG4gICAgY29uc3QgY29tbWFuZExpbmVWYWx1ZSA9IHBhcnNlZEFyZ3Nba2V5XTtcblxuICAgIC8vIGlmIHRoZSBjb21tYW5kIGxpbmUgdmFsdWUgaXMgdGhlIGRlZmF1bHQgdmFsdWUsIGFuZCBhbiBlbnYgdmFsdWUgd2FzIHNldFxuICAgIC8vIHVzZSB0aGUgZW52IHZhbHVlLCBvdGhlcndpc2UgdXNlIHRoZSBjb21tYW5kIGxpbmUgdmFsdWUgd2hpY2ggd2lsbCBiZSB0aGVcbiAgICAvLyBkZWZhdWx0L2NsaSB2YWx1ZVxuICAgIGxldCB2YWx1ZSA9IGNvbW1hbmRMaW5lVmFsdWUgPT09IGRlZmF1bHRzW2tleV0gJiYgZW52VmFsdWVcbiAgICAgICAgPyB1blN0cmluZ2lmeShlbnZWYWx1ZSlcbiAgICAgICAgOiBjb21tYW5kTGluZVZhbHVlO1xuXG4gICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgIC8vIFdlIHdhbnQgdW5kZWZpbmVkIHRvIGJlIGNvcnJlY3QgZm9yID8gdHlwZXMuXG4gICAgICAgIHZhbHVlID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGNvbnN0IGFyZyA9IHBhcnNlckFyZ0J5RGVzdC5nZXQoa2V5KTtcbiAgICBpZiAoYXJnICYmIGFyZy5uYXJncyAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsgLy8gSXQgaXMgbm90IGFuIGFycmF5LCBidXQgc2hvdWxkIGJlIChwcm9iYWJseSBzdHJpbmcgZnJvbSBkb3RlbnYpXG4gICAgICAgIHZhbHVlID0gdmFsdWUgPT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgPyBbXVxuICAgICAgICAgICAgOiBTdHJpbmcodmFsdWUpXG4gICAgICAgICAgICAgICAgLnNwbGl0KFwiLFwiKSAvLyBTcGxpdCBvbiBjb21tYXMgdG8gY3JlYXRlIGFuIGFycmF5XG4gICAgICAgICAgICAgICAgLm1hcCgoc3RyKSA9PiBzdHIudHJpbSgpKTsgLy8gQW5kIHRyaW0gZWFjaCBzdHJpbmcgb2Ygd2hpdGVzcGFjZVxuICAgIH1cblxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnkgbm8tdW5zYWZlLWFueSAtIGhhdmUgdG8gc2V0IGZvciBJQXJnc1xuICAgIChhcmdzIGFzIGFueSlba2V5XSA9IHZhbHVlO1xufVxuXG4vLyBub3QgZXhwb3NlZCBiZWNhdXNlIHRoaXMgaXMgYW4gZWFzeSB0aGluZyB0byBmdWNrIHVwIGV2ZXJ5dGhpbmcgZWxzZSB3aXRoIGlmIHlvdSBjaGFuZ2UgaXRcbmFyZ3MuQkFTRV9ESVIgPSBhcmdzLkJBU0VfRElSIHx8IF9fZGlybmFtZTtcblxuaWYgKHByb2Nlc3MuZW52LldPUktFUl9HQU1FX1NFU1NJT05fREFUQSkge1xuICAgIC8vIGhhY2tpc2gsIGJ1dCBsZXQncyBhc3N1bWUgaWYgdGhlIGRhdGEgaXMgc2V0IGl0IGlzIGluIHRoZSBjb3JyZWN0IGZvcm1hdC5cbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tdW5zYWZlLWFueVxuICAgIGFyZ3MuV09SS0VSX0RBVEEgPSBKU09OLnBhcnNlKHByb2Nlc3MuZW52LldPUktFUl9HQU1FX1NFU1NJT05fREFUQSk7XG59XG5cbmlmIChhcmdzLlJVTl9QUk9GSUxFUikge1xuICAgIHRyeSB7XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby12YXItcmVxdWlyZXMgbm8tcmVxdWlyZS1pbXBvcnRzXG4gICAgICAgIGlmICghcmVxdWlyZShcInY4LXByb2ZpbGVyXCIpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbXVsdGlsaW5lLXN0cmluZ1xuYEVSUk9SOiBNb2R1bGUgJ3Y4LXByb2ZpbGVyJyBub3QgZm91bmQgYW5kIGlzIG5lZWRlZCBmb3IgcHJvZmlsaW5nLlxuUGxlYXNlIHVzZSAnbnBtIGluc3RhbGwgdjgtcHJvZmlsZXInLlxuTk9URTogVGhpcyB3aWxsIHJlcXVpcmUgbm9kZS1neXAgdG8gY29tcGlsZSBpdHMgQysrIGFkZG9ucy5gLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgIH1cbn1cblxuaWYgKGFyZ3MuQVJFTkFfTU9ERSkge1xuICAgIGFyZ3MuTE9HX1RPX0ZJTEVTID0gdHJ1ZTtcbiAgICBhcmdzLkdBTUVfU0VUVElOR1NfRU5BQkxFRCA9IGZhbHNlO1xuICAgIGFyZ3MuV0VCX0VOQUJMRUQgPSBmYWxzZTtcbiAgICBhcmdzLlVQREFURVJfRU5BQkxFRCA9IGZhbHNlO1xuICAgIGFyZ3MuQVVUT19VUERBVEUgPSBmYWxzZTtcbn1cblxuaWYgKCFpc05hTihhcmdzLlBPUlRfT0ZGU0VUKSkge1xuICAgIGFyZ3MuVENQX1BPUlQgKz0gYXJncy5QT1JUX09GRlNFVDtcbiAgICBhcmdzLkhUVFBfUE9SVCArPSBhcmdzLlBPUlRfT0ZGU0VUO1xuICAgIGFyZ3MuV1NfUE9SVCArPSBhcmdzLlBPUlRfT0ZGU0VUO1xufVxuXG4vKiogVGhlIGN1cnJlbnQgY29uZmlnIGFzIHNldCBmcm9tIENMSSBhbmQgdGhlIC5lbnYgZmlsZS4gKi9cbmV4cG9ydCBjb25zdCBDb25maWcgPSBPYmplY3QuZnJlZXplKGFyZ3MpO1xuIl19