"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const _1 = require("./");
// <<-- Creer-Merge: imports -->>
const gaussian = require("gaussian");
// <<-- /Creer-Merge: imports -->>
/**
 * Use cowboys to have a good time and play some music on a Piano, while
 * brawling with enemy Cowboys.
 */
class SaloonGame extends _1.BaseClasses.Game {
    // <<-- Creer-Merge: attributes -->>
    // Any additional member attributes can go here
    // NOTE: They will not be sent to the AIs, those must be defined
    // in the creer file.
    // <<-- /Creer-Merge: attributes -->>
    /**
     * Called when a Game is created.
     *
     * @param settingsManager - The manager that holds initial settings.
     * @param required - Data required to initialize this (ignore it).
     */
    constructor(settingsManager, required) {
        super(settingsManager, required);
        this.settingsManager = settingsManager;
        /** The settings used to initialize the game, as set by players */
        this.settings = Object.freeze(this.settingsManager.values);
        // <<-- Creer-Merge: constructor -->>
        this.jobs.push("Sharpshooter", "Bartender", "Brawler");
        const minFurnishings = 0;
        const maxFurnishings = 5;
        const minHazards = 0;
        const maxHazards = 12;
        // make top and bottom sides walls
        for (let x = 0; x < this.mapWidth; x++) {
            const topTile = this.getTile(x, 0);
            const bottomTile = this.getTile(x, this.mapHeight - 1);
            if (!topTile || !bottomTile) {
                throw new Error(`Could not make top or bottom tile at x=${x} a balcony.`);
            }
            topTile.isBalcony = true;
            bottomTile.isBalcony = true;
        }
        // make left and right sides walls
        for (let y = 0; y < this.mapHeight; y++) {
            const leftTile = this.getTile(0, y);
            const rightTile = this.getTile(this.mapWidth - 1, y);
            if (!leftTile || !rightTile) {
                throw new Error(`Could not make top or bottom tile at y=${y} a balcony.`);
            }
            leftTile.isBalcony = true;
            rightTile.isBalcony = true;
        }
        // spawn some random furnishings in quadrants
        let numFurnishings = this.manager.random.int(maxFurnishings, minFurnishings) * 2; // *2 for each side
        const rand = this.manager.random.float();
        let numPianos = 2;
        // 80% of the time, have 4 pianos
        if (rand < 0.80) {
            numPianos = 4;
        }
        // the other 15% of the time have 6
        else if (rand < 0.95) {
            numPianos = 6;
        }
        // and 5% of the time have 8
        else {
            numPianos = 8;
        }
        const distributionX = gaussian(this.mapWidth / 2, this.mapWidth / 3);
        const distributionY = gaussian(this.mapHeight / 2, this.mapHeight / 3);
        let numHazards = this.manager.random.int(maxHazards, minHazards) * 2;
        // while there is stuff to spawn
        while (numFurnishings > 0 || numPianos > 0 || numHazards > 0) {
            // get a random tile on this side that is empty
            let x = 0;
            let y = 0;
            while (true) {
                x = Math.round(distributionX.ppf(this.manager.random.float()));
                y = Math.round(distributionY.ppf(this.manager.random.float()));
                const tile = this.getTile(x, y);
                if (tile && !tile.furnishing && !tile.isBalcony) {
                    break; // because we found a tile that does not have a
                    // furnishing to spawn one on, else we continue our
                    // random search
                }
            }
            for (let side = 0; side < 2; side++) { // for each side (left and right)
                if (side === 1) { // if the right side, invert the x, y coordinate
                    x = this.mapWidth - x - 1;
                    y = this.mapHeight - y - 1;
                }
                if (numHazards > 0) { // if there are hazards to spawn
                    numHazards--;
                    const tile = this.getTile(x, y);
                    if (!tile) {
                        throw new Error(`(${x},${y} is out of range to place a hazard on!`);
                    }
                    tile.hasHazard = true; // "spawn" it by setting that tile's hasHazard to true
                }
                else { // need to spawn a furnishing
                    const tile = this.getTile(x, y);
                    if (!tile) {
                        throw new Error(`No tile at (${x}, ${y}) to place Furnishing on!`);
                    }
                    this.manager.create.furnishing({
                        tile,
                        // if there are pianos to spawn, make it one, else false and thus it is not a piano
                        isPiano: numPianos > 0,
                    });
                    if (numPianos > 0) { // decrement whatever we spawned
                        numPianos--;
                    }
                    else {
                        numFurnishings--;
                    }
                }
            }
        }
        // create the players' Young Guns
        for (let i = 0; i < this.players.length; i++) {
            const player = this.players[i];
            let x = 0;
            let y = 0;
            let dy = 1;
            if (i > 0) { // then change x, y for the second player
                x = this.mapWidth - 1;
                y = this.mapHeight - 1;
                dy = -1;
            }
            // used for moving the young guns around the map,
            // but not a property exposed to clients
            const previousTile = this.getTile(x, y + dy * 2);
            const tile = this.getTile(x, y + dy);
            if (!tile || !previousTile) {
                throw new Error("Could not find tiles to place YoungGun on!");
            }
            player.youngGun = this.manager.create.youngGun({
                owner: player,
                tile,
                canCallIn: true,
                previousTile,
            });
        }
        // <<-- /Creer-Merge: constructor -->>
    }
    // <<-- Creer-Merge: public-functions -->>
    // Any public functions can go here for other things in the game to use.
    // NOTE: Client AIs cannot call these functions, those must be defined
    // in the creer file.
    // <<-- /Creer-Merge: public-functions -->>
    /**
     * Gets the tile at (x, y), or undefined if the co-ordinates are off-map.
     *
     * @param x - The x position of the desired tile.
     * @param y - The y position of the desired tile.
     * @returns The Tile at (x, y) if valid, undefined otherwise.
     */
    getTile(x, y) {
        // tslint:disable-next-line:no-unsafe-any
        return super.getTile(x, y);
    }
}
exports.SaloonGame = SaloonGame;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FtZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9nYW1lcy9zYWxvb24vZ2FtZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHlCQUFpQztBQVVqQyxpQ0FBaUM7QUFFakMscUNBQXFDO0FBTXJDLGtDQUFrQztBQUVsQzs7O0dBR0c7QUFDSCxNQUFhLFVBQVcsU0FBUSxjQUFXLENBQUMsSUFBSTtJQXdINUMsb0NBQW9DO0lBRXBDLCtDQUErQztJQUMvQyxnRUFBZ0U7SUFDaEUscUJBQXFCO0lBRXJCLHFDQUFxQztJQUVyQzs7Ozs7T0FLRztJQUNILFlBQ2MsZUFBMEMsRUFDcEQsUUFBeUM7UUFFekMsS0FBSyxDQUFDLGVBQWUsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUh2QixvQkFBZSxHQUFmLGVBQWUsQ0FBMkI7UUFuSXhELGtFQUFrRTtRQUNsRCxhQUFRLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBdUlsRSxxQ0FBcUM7UUFFckMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQ1YsY0FBYyxFQUNkLFdBQVcsRUFDWCxTQUFTLENBQ1osQ0FBQztRQUVGLE1BQU0sY0FBYyxHQUFHLENBQUMsQ0FBQztRQUN6QixNQUFNLGNBQWMsR0FBRyxDQUFDLENBQUM7UUFDekIsTUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ3JCLE1BQU0sVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUV0QixrQ0FBa0M7UUFDbEMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDcEMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDbkMsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUs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QSxNQUF3QixDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7Z0JBQzlELEtBQUssRUFBRSxNQUFNO2dCQUNiLElBQUk7Z0JBQ0osU0FBUyxFQUFFLElBQUk7Z0JBQ2YsWUFBWTthQUNmLENBQUMsQ0FBQztTQUNOO1FBRUQsc0NBQXNDO0lBQzFDLENBQUM7SUFFRCwwQ0FBMEM7SUFFMUMsd0VBQXdFO0lBQ3hFLHNFQUFzRTtJQUN0RSxxQkFBcUI7SUFFckIsMkNBQTJDO0lBRTNDOzs7Ozs7T0FNRztJQUNJLE9BQU8sQ0FBQyxDQUFTLEVBQUUsQ0FBUztRQUMvQix5Q0FBeUM7UUFDekMsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQXFCLENBQUM7SUFDbkQsQ0FBQztDQU9KO0FBdFRELGdDQXNUQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElCYXNlR2FtZVJlcXVpcmVkRGF0YSB9IGZyb20gXCJ+L2NvcmUvZ2FtZVwiO1xuaW1wb3J0IHsgQmFzZUNsYXNzZXMgfSBmcm9tIFwiLi9cIjtcbmltcG9ydCB7IEJvdHRsZSB9IGZyb20gXCIuL2JvdHRsZVwiO1xuaW1wb3J0IHsgQ293Ym95IH0gZnJvbSBcIi4vY293Ym95XCI7XG5pbXBvcnQgeyBGdXJuaXNoaW5nIH0gZnJvbSBcIi4vZnVybmlzaGluZ1wiO1xuaW1wb3J0IHsgU2Fsb29uR2FtZU1hbmFnZXIgfSBmcm9tIFwiLi9nYW1lLW1hbmFnZXJcIjtcbmltcG9ydCB7IEdhbWVPYmplY3QgfSBmcm9tIFwiLi9nYW1lLW9iamVjdFwiO1xuaW1wb3J0IHsgU2Fsb29uR2FtZVNldHRpbmdzTWFuYWdlciB9IGZyb20gXCIuL2dhbWUtc2V0dGluZ3NcIjtcbmltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuL3BsYXllclwiO1xuaW1wb3J0IHsgVGlsZSB9IGZyb20gXCIuL3RpbGVcIjtcblxuLy8gPDwtLSBDcmVlci1NZXJnZTogaW1wb3J0cyAtLT4+XG5cbmltcG9ydCAqIGFzIGdhdXNzaWFuIGZyb20gXCJnYXVzc2lhblwiO1xuaW1wb3J0IHsgTXV0YWJsZSB9IGZyb20gXCJ+L3V0aWxzXCI7XG5cbi8qKiBBIHBsYXllciB0aGF0IGNhbiBtdXRhdGUgYmVmb3JlIHRoZSBnYW1lIHN0YXJ0cyAqL1xudHlwZSBNdXRhYmxlUGxheWVyID0gTXV0YWJsZTxQbGF5ZXI+O1xuXG4vLyA8PC0tIC9DcmVlci1NZXJnZTogaW1wb3J0cyAtLT4+XG5cbi8qKlxuICogVXNlIGNvd2JveXMgdG8gaGF2ZSBhIGdvb2QgdGltZSBhbmQgcGxheSBzb21lIG11c2ljIG9uIGEgUGlhbm8sIHdoaWxlXG4gKiBicmF3bGluZyB3aXRoIGVuZW15IENvd2JveXMuXG4gKi9cbmV4cG9ydCBjbGFzcyBTYWxvb25HYW1lIGV4dGVuZHMgQmFzZUNsYXNzZXMuR2FtZSB7XG4gICAgLyoqIFRoZSBtYW5hZ2VyIG9mIHRoaXMgZ2FtZSwgdGhhdCBjb250cm9scyBldmVyeXRoaW5nIGFyb3VuZCBpdCAqL1xuICAgIHB1YmxpYyByZWFkb25seSBtYW5hZ2VyITogU2Fsb29uR2FtZU1hbmFnZXI7XG5cbiAgICAvKiogVGhlIHNldHRpbmdzIHVzZWQgdG8gaW5pdGlhbGl6ZSB0aGUgZ2FtZSwgYXMgc2V0IGJ5IHBsYXllcnMgKi9cbiAgICBwdWJsaWMgcmVhZG9ubHkgc2V0dGluZ3MgPSBPYmplY3QuZnJlZXplKHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnZhbHVlcyk7XG5cbiAgICAvKipcbiAgICAgKiBIb3cgbWFueSB0dXJucyBhIEJhcnRlbmRlciB3aWxsIGJlIGJ1c3kgZm9yIGFmdGVyIHRocm93aW5nIGEgQm90dGxlLlxuICAgICAqL1xuICAgIHB1YmxpYyByZWFkb25seSBiYXJ0ZW5kZXJDb29sZG93biE6IG51bWJlcjtcblxuICAgIC8qKlxuICAgICAqIEFsbCB0aGUgYmVlciBCb3R0bGVzIGN1cnJlbnRseSBmbHlpbmcgYWNyb3NzIHRoZSBzYWxvb24gaW4gdGhlIGdhbWUuXG4gICAgICovXG4gICAgcHVibGljIGJvdHRsZXMhOiBCb3R0bGVbXTtcblxuICAgIC8qKlxuICAgICAqIEhvdyBtdWNoIGRhbWFnZSBpcyBhcHBsaWVkIHRvIG5laWdoYm9yaW5nIHRoaW5ncyBiaXQgYnkgdGhlIFNoYXJwc2hvb3RlclxuICAgICAqIGJldHdlZW4gdHVybnMuXG4gICAgICovXG4gICAgcHVibGljIHJlYWRvbmx5IGJyYXdsZXJEYW1hZ2UhOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBFdmVyeSBDb3dib3kgaW4gdGhlIGdhbWUuXG4gICAgICovXG4gICAgcHVibGljIGNvd2JveXMhOiBDb3dib3lbXTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBwbGF5ZXIgd2hvc2UgdHVybiBpdCBpcyBjdXJyZW50bHkuIFRoYXQgcGxheWVyIGNhbiBzZW5kIGNvbW1hbmRzLlxuICAgICAqIE90aGVyIHBsYXllcnMgY2Fubm90LlxuICAgICAqL1xuICAgIHB1YmxpYyBjdXJyZW50UGxheWVyITogUGxheWVyO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGN1cnJlbnQgdHVybiBudW1iZXIsIHN0YXJ0aW5nIGF0IDAgZm9yIHRoZSBmaXJzdCBwbGF5ZXIncyB0dXJuLlxuICAgICAqL1xuICAgIHB1YmxpYyBjdXJyZW50VHVybiE6IG51bWJlcjtcblxuICAgIC8qKlxuICAgICAqIEV2ZXJ5IGZ1cm5pc2hpbmcgaW4gdGhlIGdhbWUuXG4gICAgICovXG4gICAgcHVibGljIGZ1cm5pc2hpbmdzITogRnVybmlzaGluZ1tdO1xuXG4gICAgLyoqXG4gICAgICogQSBtYXBwaW5nIG9mIGV2ZXJ5IGdhbWUgb2JqZWN0J3MgSUQgdG8gdGhlIGFjdHVhbCBnYW1lIG9iamVjdC4gUHJpbWFyaWx5XG4gICAgICogdXNlZCBieSB0aGUgc2VydmVyIGFuZCBjbGllbnQgdG8gZWFzaWx5IHJlZmVyIHRvIHRoZSBnYW1lIG9iamVjdHMgdmlhXG4gICAgICogSUQuXG4gICAgICovXG4gICAgcHVibGljIGdhbWVPYmplY3RzIToge1tpZDogc3RyaW5nXTogR2FtZU9iamVjdH07XG5cbiAgICAvKipcbiAgICAgKiBBbGwgdGhlIGpvYnMgdGhhdCBDb3dib3lzIGNhbiBiZSBjYWxsZWQgaW4gd2l0aC5cbiAgICAgKi9cbiAgICBwdWJsaWMgam9icyE6IHN0cmluZ1tdO1xuXG4gICAgLyoqXG4gICAgICogVGhlIG51bWJlciBvZiBUaWxlcyBpbiB0aGUgbWFwIGFsb25nIHRoZSB5ICh2ZXJ0aWNhbCkgYXhpcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgcmVhZG9ubHkgbWFwSGVpZ2h0ITogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogVGhlIG51bWJlciBvZiBUaWxlcyBpbiB0aGUgbWFwIGFsb25nIHRoZSB4IChob3Jpem9udGFsKSBheGlzLlxuICAgICAqL1xuICAgIHB1YmxpYyByZWFkb25seSBtYXBXaWR0aCE6IG51bWJlcjtcblxuICAgIC8qKlxuICAgICAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiBDb3dib3lzIGEgUGxheWVyIGNhbiBicmluZyBpbnRvIHRoZSBzYWxvb24gb2YgZWFjaFxuICAgICAqIHNwZWNpZmljIGpvYi5cbiAgICAgKi9cbiAgICBwdWJsaWMgcmVhZG9ubHkgbWF4Q293Ym95c1BlckpvYiE6IG51bWJlcjtcblxuICAgIC8qKlxuICAgICAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiB0dXJucyBiZWZvcmUgdGhlIGdhbWUgd2lsbCBhdXRvbWF0aWNhbGx5IGVuZC5cbiAgICAgKi9cbiAgICBwdWJsaWMgcmVhZG9ubHkgbWF4VHVybnMhOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBMaXN0IG9mIGFsbCB0aGUgcGxheWVycyBpbiB0aGUgZ2FtZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgcGxheWVycyE6IFBsYXllcltdO1xuXG4gICAgLyoqXG4gICAgICogV2hlbiBhIHBsYXllcidzIHJvd2RpbmVzcyByZWFjaGVzIG9yIGV4Y2VlZHMgdGhpcyBudW1iZXIgdGhlaXIgQ293Ym95c1xuICAgICAqIHRha2UgYSBjb2xsZWN0aXZlIHNpZXN0YS5cbiAgICAgKi9cbiAgICBwdWJsaWMgcmVhZG9ubHkgcm93ZGluZXNzVG9TaWVzdGEhOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBBIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgZ2FtZSBpbnN0YW5jZSB0aGF0IGlzIGJlaW5nIHBsYXllZC5cbiAgICAgKi9cbiAgICBwdWJsaWMgcmVhZG9ubHkgc2Vzc2lvbiE6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIEhvdyBtdWNoIGRhbWFnZSBpcyBhcHBsaWVkIHRvIHRoaW5ncyBoaXQgYnkgU2hhcnBzaG9vdGVycyB3aGVuIHRoZXkgYWN0LlxuICAgICAqL1xuICAgIHB1YmxpYyByZWFkb25seSBzaGFycHNob290ZXJEYW1hZ2UhOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBIb3cgbG9uZyBzaWVzdGFzIGFyZSBmb3IgYSBwbGF5ZXIncyB0ZWFtLlxuICAgICAqL1xuICAgIHB1YmxpYyByZWFkb25seSBzaWVzdGFMZW5ndGghOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBBbGwgdGhlIHRpbGVzIGluIHRoZSBtYXAsIHN0b3JlZCBpbiBSb3ctbWFqb3Igb3JkZXIuIFVzZSBgeCArIHkgKlxuICAgICAqIG1hcFdpZHRoYCB0byBhY2Nlc3MgdGhlIGNvcnJlY3QgaW5kZXguXG4gICAgICovXG4gICAgcHVibGljIHRpbGVzITogVGlsZVtdO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGFtb3VudCBvZiB0aW1lIChpbiBuYW5vLXNlY29uZHMpIGFkZGVkIGFmdGVyIGVhY2ggcGxheWVyIHBlcmZvcm1zIGFcbiAgICAgKiB0dXJuLlxuICAgICAqL1xuICAgIHB1YmxpYyByZWFkb25seSB0aW1lQWRkZWRQZXJUdXJuITogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogSG93IG1hbnkgdHVybnMgYSBDb3dib3kgd2lsbCBiZSBkcnVuayBmb3IgaWYgYSBib3R0bGUgYnJlYWtzIG9uIGl0LlxuICAgICAqL1xuICAgIHB1YmxpYyByZWFkb25seSB0dXJuc0RydW5rITogbnVtYmVyO1xuXG4gICAgLy8gPDwtLSBDcmVlci1NZXJnZTogYXR0cmlidXRlcyAtLT4+XG5cbiAgICAvLyBBbnkgYWRkaXRpb25hbCBtZW1iZXIgYXR0cmlidXRlcyBjYW4gZ28gaGVyZVxuICAgIC8vIE5PVEU6IFRoZXkgd2lsbCBub3QgYmUgc2VudCB0byB0aGUgQUlzLCB0aG9zZSBtdXN0IGJlIGRlZmluZWRcbiAgICAvLyBpbiB0aGUgY3JlZXIgZmlsZS5cblxuICAgIC8vIDw8LS0gL0NyZWVyLU1lcmdlOiBhdHRyaWJ1dGVzIC0tPj5cblxuICAgIC8qKlxuICAgICAqIENhbGxlZCB3aGVuIGEgR2FtZSBpcyBjcmVhdGVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHNldHRpbmdzTWFuYWdlciAtIFRoZSBtYW5hZ2VyIHRoYXQgaG9sZHMgaW5pdGlhbCBzZXR0aW5ncy5cbiAgICAgKiBAcGFyYW0gcmVxdWlyZWQgLSBEYXRhIHJlcXVpcmVkIHRvIGluaXRpYWxpemUgdGhpcyAoaWdub3JlIGl0KS5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJvdGVjdGVkIHNldHRpbmdzTWFuYWdlcjogU2Fsb29uR2FtZVNldHRpbmdzTWFuYWdlcixcbiAgICAgICAgcmVxdWlyZWQ6IFJlYWRvbmx5PElCYXNlR2FtZVJlcXVpcmVkRGF0YT4sXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKHNldHRpbmdzTWFuYWdlciwgcmVxdWlyZWQpO1xuXG4gICAgICAgIC8vIDw8LS0gQ3JlZXItTWVyZ2U6IGNvbnN0cnVjdG9yIC0tPj5cblxuICAgICAgICB0aGlzLmpvYnMucHVzaChcbiAgICAgICAgICAgIFwiU2hhcnBzaG9vdGVyXCIsXG4gICAgICAgICAgICBcIkJhcnRlbmRlclwiLFxuICAgICAgICAgICAgXCJCcmF3bGVyXCIsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgbWluRnVybmlzaGluZ3MgPSAwO1xuICAgICAgICBjb25zdCBtYXhGdXJuaXNoaW5ncyA9IDU7XG4gICAgICAgIGNvbnN0IG1pbkhhemFyZHMgPSAwO1xuICAgICAgICBjb25zdCBtYXhIYXphcmRzID0gMTI7XG5cbiAgICAgICAgLy8gbWFrZSB0b3AgYW5kIGJvdHRvbSBzaWRlcyB3YWxsc1xuICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHRoaXMubWFwV2lkdGg7IHgrKykge1xuICAgICAgICAgICAgY29uc3QgdG9wVGlsZSA9IHRoaXMuZ2V0VGlsZSh4LCAwKTtcbiAgICAgICAgICAgIGNvbnN0IGJvdHRvbVRpbGUgPSB0aGlzLmdldFRpbGUoeCwgdGhpcy5tYXBIZWlnaHQgLSAxKTtcbiAgICAgICAgICAgIGlmICghdG9wVGlsZSB8fCAhYm90dG9tVGlsZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IG1ha2UgdG9wIG9yIGJvdHRvbSB0aWxlIGF0IHg9JHt4fSBhIGJhbGNvbnkuYCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRvcFRpbGUuaXNCYWxjb255ID0gdHJ1ZTtcbiAgICAgICAgICAgIGJvdHRvbVRpbGUuaXNCYWxjb255ID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG1ha2UgbGVmdCBhbmQgcmlnaHQgc2lkZXMgd2FsbHNcbiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLm1hcEhlaWdodDsgeSsrKSB7XG4gICAgICAgICAgICBjb25zdCBsZWZ0VGlsZSA9IHRoaXMuZ2V0VGlsZSgwLCB5KTtcbiAgICAgICAgICAgIGNvbnN0IHJpZ2h0VGlsZSA9IHRoaXMuZ2V0VGlsZSh0aGlzLm1hcFdpZHRoIC0gMSwgeSk7XG4gICAgICAgICAgICBpZiAoIWxlZnRUaWxlIHx8ICFyaWdodFRpbGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBtYWtlIHRvcCBvciBib3R0b20gdGlsZSBhdCB5PSR7eX0gYSBiYWxjb255LmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGVmdFRpbGUuaXNCYWxjb255ID0gdHJ1ZTtcbiAgICAgICAgICAgIHJpZ2h0VGlsZS5pc0JhbGNvbnkgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc3Bhd24gc29tZSByYW5kb20gZnVybmlzaGluZ3MgaW4gcXVhZHJhbnRzXG4gICAgICAgIGxldCBudW1GdXJuaXNoaW5ncyA9IHRoaXMubWFuYWdlci5yYW5kb20uaW50KG1heEZ1cm5pc2hpbmdzLCBtaW5GdXJuaXNoaW5ncykgKiAyOyAvLyAqMiBmb3IgZWFjaCBzaWRlXG5cbiAgICAgICAgY29uc3QgcmFuZCA9IHRoaXMubWFuYWdlci5yYW5kb20uZmxvYXQoKTtcbiAgICAgICAgbGV0IG51bVBpYW5vcyA9IDI7XG4gICAgICAgIC8vIDgwJSBvZiB0aGUgdGltZSwgaGF2ZSA0IHBpYW5vc1xuICAgICAgICBpZiAocmFuZCA8IDAuODApIHtcbiAgICAgICAgICAgIG51bVBpYW5vcyA9IDQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdGhlIG90aGVyIDE1JSBvZiB0aGUgdGltZSBoYXZlIDZcbiAgICAgICAgZWxzZSBpZiAocmFuZCA8IDAuOTUpIHtcbiAgICAgICAgICAgIG51bVBpYW5vcyA9IDY7XG4gICAgICAgIH1cbiAgICAgICAgLy8gYW5kIDUlIG9mIHRoZSB0aW1lIGhhdmUgOFxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG51bVBpYW5vcyA9IDg7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkaXN0cmlidXRpb25YID0gZ2F1c3NpYW4odGhpcy5tYXBXaWR0aCAvIDIsIHRoaXMubWFwV2lkdGggLyAzKTtcbiAgICAgICAgY29uc3QgZGlzdHJpYnV0aW9uWSA9IGdhdXNzaWFuKHRoaXMubWFwSGVpZ2h0IC8gMiwgdGhpcy5tYXBIZWlnaHQgLyAzKTtcblxuICAgICAgICBsZXQgbnVtSGF6YXJkcyA9IHRoaXMubWFuYWdlci5yYW5kb20uaW50KG1heEhhemFyZHMsIG1pbkhhemFyZHMpICogMjtcblxuICAgICAgICAvLyB3aGlsZSB0aGVyZSBpcyBzdHVmZiB0byBzcGF3blxuICAgICAgICB3aGlsZSAobnVtRnVybmlzaGluZ3MgPiAwIHx8IG51bVBpYW5vcyA+IDAgfHwgbnVtSGF6YXJkcyA+IDApIHtcbiAgICAgICAgICAgIC8vIGdldCBhIHJhbmRvbSB0aWxlIG9uIHRoaXMgc2lkZSB0aGF0IGlzIGVtcHR5XG4gICAgICAgICAgICBsZXQgeCA9IDA7XG4gICAgICAgICAgICBsZXQgeSA9IDA7XG5cbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgeCA9IE1hdGgucm91bmQoZGlzdHJpYnV0aW9uWC5wcGYodGhpcy5tYW5hZ2VyLnJhbmRvbS5mbG9hdCgpKSk7XG4gICAgICAgICAgICAgICAgeSA9IE1hdGgucm91bmQoZGlzdHJpYnV0aW9uWS5wcGYodGhpcy5tYW5hZ2VyLnJhbmRvbS5mbG9hdCgpKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGlsZSA9IHRoaXMuZ2V0VGlsZSh4LCB5KTtcblxuICAgICAgICAgICAgICAgIGlmICh0aWxlICYmICF0aWxlLmZ1cm5pc2hpbmcgJiYgIXRpbGUuaXNCYWxjb255KSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBiZWNhdXNlIHdlIGZvdW5kIGEgdGlsZSB0aGF0IGRvZXMgbm90IGhhdmUgYVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZnVybmlzaGluZyB0byBzcGF3biBvbmUgb24sIGVsc2Ugd2UgY29udGludWUgb3VyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByYW5kb20gc2VhcmNoXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKGxldCBzaWRlID0gMDsgc2lkZSA8IDI7IHNpZGUrKykgeyAvLyBmb3IgZWFjaCBzaWRlIChsZWZ0IGFuZCByaWdodClcbiAgICAgICAgICAgICAgICBpZiAoc2lkZSA9PT0gMSkgeyAvLyBpZiB0aGUgcmlnaHQgc2lkZSwgaW52ZXJ0IHRoZSB4LCB5IGNvb3JkaW5hdGVcbiAgICAgICAgICAgICAgICAgICAgeCA9IHRoaXMubWFwV2lkdGggLSB4IC0gMTtcbiAgICAgICAgICAgICAgICAgICAgeSA9IHRoaXMubWFwSGVpZ2h0IC0geSAtIDE7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG51bUhhemFyZHMgPiAwKSB7IC8vIGlmIHRoZXJlIGFyZSBoYXphcmRzIHRvIHNwYXduXG4gICAgICAgICAgICAgICAgICAgIG51bUhhemFyZHMtLTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGlsZSA9IHRoaXMuZ2V0VGlsZSh4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCgke3h9LCR7eX0gaXMgb3V0IG9mIHJhbmdlIHRvIHBsYWNlIGEgaGF6YXJkIG9uIWApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRpbGUuaGFzSGF6YXJkID0gdHJ1ZTsgLy8gXCJzcGF3blwiIGl0IGJ5IHNldHRpbmcgdGhhdCB0aWxlJ3MgaGFzSGF6YXJkIHRvIHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7IC8vIG5lZWQgdG8gc3Bhd24gYSBmdXJuaXNoaW5nXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbGUgPSB0aGlzLmdldFRpbGUoeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyB0aWxlIGF0ICgke3h9LCAke3l9KSB0byBwbGFjZSBGdXJuaXNoaW5nIG9uIWApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFuYWdlci5jcmVhdGUuZnVybmlzaGluZyh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aWxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIHBpYW5vcyB0byBzcGF3biwgbWFrZSBpdCBvbmUsIGVsc2UgZmFsc2UgYW5kIHRodXMgaXQgaXMgbm90IGEgcGlhbm9cbiAgICAgICAgICAgICAgICAgICAgICAgIGlzUGlhbm86IG51bVBpYW5vcyA+IDAsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChudW1QaWFub3MgPiAwKSB7IC8vIGRlY3JlbWVudCB3aGF0ZXZlciB3ZSBzcGF3bmVkXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1QaWFub3MtLTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bUZ1cm5pc2hpbmdzLS07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjcmVhdGUgdGhlIHBsYXllcnMnIFlvdW5nIEd1bnNcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXllcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHBsYXllciA9IHRoaXMucGxheWVyc1tpXTtcblxuICAgICAgICAgICAgbGV0IHggPSAwO1xuICAgICAgICAgICAgbGV0IHkgPSAwO1xuICAgICAgICAgICAgbGV0IGR5ID0gMTtcbiAgICAgICAgICAgIGlmIChpID4gMCkgeyAvLyB0aGVuIGNoYW5nZSB4LCB5IGZvciB0aGUgc2Vjb25kIHBsYXllclxuICAgICAgICAgICAgICAgIHggPSB0aGlzLm1hcFdpZHRoIC0gMTtcbiAgICAgICAgICAgICAgICB5ID0gdGhpcy5tYXBIZWlnaHQgLSAxO1xuICAgICAgICAgICAgICAgIGR5ID0gLTE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHVzZWQgZm9yIG1vdmluZyB0aGUgeW91bmcgZ3VucyBhcm91bmQgdGhlIG1hcCxcbiAgICAgICAgICAgIC8vIGJ1dCBub3QgYSBwcm9wZXJ0eSBleHBvc2VkIHRvIGNsaWVudHNcbiAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzVGlsZSA9IHRoaXMuZ2V0VGlsZSh4LCB5ICsgZHkgKiAyKTtcbiAgICAgICAgICAgIGNvbnN0IHRpbGUgPSB0aGlzLmdldFRpbGUoeCwgeSArIGR5KTtcblxuICAgICAgICAgICAgaWYgKCF0aWxlIHx8ICFwcmV2aW91c1RpbGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZmluZCB0aWxlcyB0byBwbGFjZSBZb3VuZ0d1biBvbiFcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIChwbGF5ZXIgYXMgTXV0YWJsZVBsYXllcikueW91bmdHdW4gPSB0aGlzLm1hbmFnZXIuY3JlYXRlLnlvdW5nR3VuKHtcbiAgICAgICAgICAgICAgICBvd25lcjogcGxheWVyLFxuICAgICAgICAgICAgICAgIHRpbGUsXG4gICAgICAgICAgICAgICAgY2FuQ2FsbEluOiB0cnVlLFxuICAgICAgICAgICAgICAgIHByZXZpb3VzVGlsZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gPDwtLSAvQ3JlZXItTWVyZ2U6IGNvbnN0cnVjdG9yIC0tPj5cbiAgICB9XG5cbiAgICAvLyA8PC0tIENyZWVyLU1lcmdlOiBwdWJsaWMtZnVuY3Rpb25zIC0tPj5cblxuICAgIC8vIEFueSBwdWJsaWMgZnVuY3Rpb25zIGNhbiBnbyBoZXJlIGZvciBvdGhlciB0aGluZ3MgaW4gdGhlIGdhbWUgdG8gdXNlLlxuICAgIC8vIE5PVEU6IENsaWVudCBBSXMgY2Fubm90IGNhbGwgdGhlc2UgZnVuY3Rpb25zLCB0aG9zZSBtdXN0IGJlIGRlZmluZWRcbiAgICAvLyBpbiB0aGUgY3JlZXIgZmlsZS5cblxuICAgIC8vIDw8LS0gL0NyZWVyLU1lcmdlOiBwdWJsaWMtZnVuY3Rpb25zIC0tPj5cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHRpbGUgYXQgKHgsIHkpLCBvciB1bmRlZmluZWQgaWYgdGhlIGNvLW9yZGluYXRlcyBhcmUgb2ZmLW1hcC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB4IC0gVGhlIHggcG9zaXRpb24gb2YgdGhlIGRlc2lyZWQgdGlsZS5cbiAgICAgKiBAcGFyYW0geSAtIFRoZSB5IHBvc2l0aW9uIG9mIHRoZSBkZXNpcmVkIHRpbGUuXG4gICAgICogQHJldHVybnMgVGhlIFRpbGUgYXQgKHgsIHkpIGlmIHZhbGlkLCB1bmRlZmluZWQgb3RoZXJ3aXNlLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRUaWxlKHg6IG51bWJlciwgeTogbnVtYmVyKTogVGlsZSB8IHVuZGVmaW5lZCB7XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby11bnNhZmUtYW55XG4gICAgICAgIHJldHVybiBzdXBlci5nZXRUaWxlKHgsIHkpIGFzIFRpbGUgfCB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLy8gPDwtLSBDcmVlci1NZXJnZTogcHJvdGVjdGVkLXByaXZhdGUtZnVuY3Rpb25zIC0tPj5cblxuICAgIC8vIEFueSBhZGRpdGlvbmFsIHByb3RlY3RlZCBvciBwaXJhdGUgbWV0aG9kcyBjYW4gZ28gaGVyZS5cblxuICAgIC8vIDw8LS0gL0NyZWVyLU1lcmdlOiBwcm90ZWN0ZWQtcHJpdmF0ZS1mdW5jdGlvbnMgLS0+PlxufVxuIl19