"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const _1 = require("./");
const job_stats_1 = require("./job-stats");
// <<-- /Creer-Merge: imports -->>
/**
 * Gather branches and build up your lodge as beavers fight to survive.
 */
class StumpedGame extends _1.BaseClasses.Game {
    // <<-- /Creer-Merge: attributes -->>
    /**
     * Called when a Game is created.
     *
     * @param settingsManager - The manager that holds initial settings.
     * @param required - Data required to initialize this (ignore it).
     */
    constructor(settingsManager, required) {
        super(settingsManager, required);
        this.settingsManager = settingsManager;
        /** The settings used to initialize the game, as set by players */
        this.settings = Object.freeze(this.settingsManager.values);
        // <<-- Creer-Merge: attributes -->>
        /**
         * The newly spawned beavers this turn that are not tracked in any arrays
         * (yet).
         */
        this.newBeavers = [];
        // <<-- Creer-Merge: constructor -->>
        this.spawnerTypes.push("branches", "food");
        for (const title of Object.keys(job_stats_1.jobStats).sort()) {
            this.jobs.push(this.manager.create.job({
                ...job_stats_1.jobStats[title],
                title,
            }));
        }
        for (const player of this.players) {
            player.calculateBranchesToBuildLodge();
        }
        this.generateMap();
        // <<-- /Creer-Merge: constructor -->>
    }
    // <<-- Creer-Merge: public-functions -->>
    // Any public functions can go here for other things in the game to use.
    // NOTE: Client AIs cannot call these functions, those must be defined
    // in the creer file.
    // <<-- /Creer-Merge: public-functions -->>
    /**
     * Gets the tile at (x, y), or undefined if the co-ordinates are off-map.
     *
     * @param x - The x position of the desired tile.
     * @param y - The y position of the desired tile.
     * @returns The Tile at (x, y) if valid, undefined otherwise.
     */
    getTile(x, y) {
        // tslint:disable-next-line:no-unsafe-any
        return super.getTile(x, y);
    }
    // <<-- Creer-Merge: protected-private-functions -->>
    /** Generates the map, by modifying tiles attributes. */
    generateMap() {
        // Lake center
        const lake = Math.floor(this.mapWidth / 2);
        // Generate random metaballs where the lake will be
        const balls = [];
        const minRadius = 0.5;
        const maxRadius = 5.0;
        const maxOffset = 2.0;
        const additionalBalls = 5;
        const gooeyNess = 1.0;
        const threshold = 3.5;
        const radiusRange = maxRadius - minRadius;
        // Initial ball (lake center)
        balls.push({
            x: lake,
            y: this.mapHeight / 2,
            r: this.manager.random.float() * radiusRange + minRadius,
        });
        // Extra balls
        for (let i = 0; i < additionalBalls; i++) {
            balls.push({
                x: lake + this.manager.random.float() * maxOffset * 2 - maxOffset,
                y: this.mapHeight / 2 - this.manager.random.float() * maxOffset,
                r: this.manager.random.float() * radiusRange + minRadius,
            });
        }
        // Generate lake from metaballs
        for (const tile of this.tiles) {
            let energy = 0;
            for (const ball of balls) {
                const r = ball.r;
                const dist = Math.sqrt(Math.pow(ball.x - tile.x, 2) + Math.pow(ball.y - tile.y, 2));
                const d = Math.max(0.0001, Math.pow(dist, gooeyNess));
                energy += r / d;
            }
            if (energy > threshold) {
                tile.type = "water";
            }
        }
        /* Generate rivers */
        const minTheta = Math.PI / 4;
        const maxTheta = Math.PI * 3 / 4;
        const minThetaDelta = Math.PI / 6;
        const maxThetaDelta = Math.PI / 4;
        const thetaDeltaRange = maxThetaDelta - minThetaDelta;
        let theta = minTheta - minThetaDelta;
        while (true) {
            theta += this.manager.random.float() * thetaDeltaRange + minThetaDelta;
            if (theta >= maxTheta) {
                break;
            }
            // console.log(`Generating river at ${theta * 180 / Math.PI} degrees`);
            // Define the line segments
            const points = [];
            // Starting point - The center of lake, at (0, 0)
            points.push({
                x: 0,
                y: 0,
            });
            // Final point - Outside the edge of the map
            points.push({
                x: this.mapWidth + this.mapHeight,
                y: 0,
            });
            // Generate fractals
            // createFractal(points, 0, 1);
            // Transform points
            const offset = Math.PI;
            for (const p of points) {
                const r = Math.sqrt(p.x * p.x + p.y * p.y);
                const t = Math.atan2(p.y, p.x) + theta + offset;
                p.x = lake + r * Math.cos(t);
                p.y = this.mapHeight / 2 + r * Math.sin(t);
            }
            // console.log("Points:");
            // console.log(points);
            // Draw line segments
            let collided = false;
            for (let i = 1; !collided && i < points.length; i++) {
                const a = points[i - 1];
                const b = points[i];
                // Useful values
                const dx = b.x - a.x;
                const dy = b.y - a.y;
                const steps = Math.max(Math.abs(dx), Math.abs(dy));
                const xInc = dx / steps;
                const yInc = dy / steps;
                let ax = a.x;
                let ay = a.y;
                let lastX = -1;
                let lastY = -1;
                for (let step = 0; !collided && step < steps; step++) {
                    ax += xInc;
                    ay += yInc;
                    const realX = Math.floor(ax);
                    const realY = Math.floor(ay);
                    const nextX = Math.floor(ax + xInc);
                    const nextY = Math.floor(ay + yInc);
                    // Verify the current tile exists
                    if (realX >= 0 && realY >= 0 && realX < this.mapWidth && realY < this.mapHeight / 2) {
                        // Set tile to water
                        const tile = this.getTile(realX, realY);
                        // Don't go diagonal
                        if (realX !== nextX && realY !== nextY) {
                            ay -= yInc;
                        }
                        // Flow direction
                        if (tile.type !== "water") {
                            if (realY > lastY) {
                                tile.flowDirection = "North";
                            }
                            else if (realY < lastY) {
                                tile.flowDirection = "South";
                            }
                            else if (realX < lastX) {
                                tile.flowDirection = "East";
                            }
                            else if (realX > lastX) {
                                tile.flowDirection = "West";
                            }
                            tile.type = "water";
                        }
                        else if (tile.flowDirection !== "") {
                            collided = true;
                        }
                    }
                    // Update last coords
                    lastX = realX;
                    lastY = realY;
                }
            }
        }
        // create spawners
        for (const type of this.spawnerTypes) {
            const max = type === "branches"
                ? this.settings.maxBranchSpawners
                : this.settings.maxFoodSpawners;
            const min = type === "branches"
                ? this.settings.minBranchSpawners
                : this.settings.minFoodSpawners;
            const count = this.manager.random.int(max, min);
            const tileType = type === "food" ? "water" : "land";
            for (let i = 0; i < count; i++) {
                let tile;
                while (!tile || tile.type !== tileType) {
                    // generate a new tile to see if it is valid
                    tile = this.getTile(this.manager.random.int(this.mapWidth - 1), this.manager.random.int(this.mapHeight / 2 - 1));
                }
                this.manager.create.spawner({ tile, type });
            }
        }
        /* Mirror map */
        for (const orig of this.tiles) {
            const target = this.getTile(orig.x, this.mapHeight - orig.y - 1);
            // Copy data
            target.type = orig.type;
            target.flowDirection = (orig.flowDirection === "North" || orig.flowDirection === "South")
                ? this.invertTileDirection(orig.flowDirection)
                : orig.flowDirection;
            // clone Spawner
            if (orig.spawner) {
                target.spawner = this.manager.create.spawner({
                    tile: target,
                    type: orig.spawner.type,
                });
            }
        }
        /* Place starting beavers */
        let p1;
        do {
            p1 = this.getTile(this.manager.random.int(this.mapWidth), this.manager.random.int(this.mapHeight / 2));
            if (!p1) {
                throw new Error("could not get random tile from expected map dimensions!");
            }
        } while (p1.spawner);
        const p2 = this.getTile(p1.x, this.mapHeight - p1.y - 1);
        if (!p2) {
            throw new Error("could not get mirrored starting tile for player 2!");
        }
        // Player 1
        this.manager.create.beaver({
            owner: this.players[0],
            tile: p1,
            job: this.jobs[0],
            recruited: true,
            branches: 1,
        });
        // Player 2
        this.manager.create.beaver({
            owner: this.players[1],
            tile: p2,
            job: this.jobs[0],
            recruited: true,
            branches: 1,
        });
        this.manager.cleanupArrays();
    }
}
exports.StumpedGame = StumpedGame;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FtZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9nYW1lcy9zdHVtcGVkL2dhbWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSx5QkFBaUM7QUFhakMsMkNBQXVDO0FBT3ZDLGtDQUFrQztBQUVsQzs7R0FFRztBQUNILE1BQWEsV0FBWSxTQUFRLGNBQVcsQ0FBQyxJQUFJO0lBK0c3QyxxQ0FBcUM7SUFFckM7Ozs7O09BS0c7SUFDSCxZQUNjLGVBQTJDLEVBQ3JELFFBQXlDO1FBRXpDLEtBQUssQ0FBQyxlQUFlLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFIdkIsb0JBQWUsR0FBZixlQUFlLENBQTRCO1FBcEh6RCxrRUFBa0U7UUFDbEQsYUFBUSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQW1HdEUsb0NBQW9DO1FBRXBDOzs7V0FHRztRQUNhLGVBQVUsR0FBYSxFQUFFLENBQUM7UUFldEMscUNBQXFDO1FBQ3JDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUUzQyxLQUFLLE1BQU0sS0FBSyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsb0JBQVEsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQzlDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUNWLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQztnQkFDcEIsR0FBRyxvQkFBUSxDQUFDLEtBQUssQ0FBQztnQkFDbEIsS0FBSzthQUNSLENBQUMsQ0FDTCxDQUFDO1NBQ0w7UUFFRCxLQUFLLE1BQU0sTUFBTSxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDL0IsTUFBTSxDQUFDLDZCQUE2QixFQUFFLENBQUM7U0FDMUM7UUFFRCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFbkIsc0NBQXNDO0lBQzFDLENB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QUM7WUFDdkIsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLElBQUksRUFBRSxFQUFFO1lBQ1IsR0FBRyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLFNBQVMsRUFBRSxJQUFJO1lBQ2YsUUFBUSxFQUFFLENBQUM7U0FDZCxDQUFDLENBQUM7UUFFSCxXQUFXO1FBQ1gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQ3ZCLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUN0QixJQUFJLEVBQUUsRUFBRTtZQUNSLEdBQUcsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNqQixTQUFTLEVBQUUsSUFBSTtZQUNmLFFBQVEsRUFBRSxDQUFDO1NBQ2QsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUNqQyxDQUFDO0NBR0o7QUF0YUQsa0NBc2FDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSUJhc2VHYW1lUmVxdWlyZWREYXRhIH0gZnJvbSBcIn4vY29yZS9nYW1lXCI7XG5pbXBvcnQgeyBCYXNlQ2xhc3NlcyB9IGZyb20gXCIuL1wiO1xuaW1wb3J0IHsgQmVhdmVyIH0gZnJvbSBcIi4vYmVhdmVyXCI7XG5pbXBvcnQgeyBTdHVtcGVkR2FtZU1hbmFnZXIgfSBmcm9tIFwiLi9nYW1lLW1hbmFnZXJcIjtcbmltcG9ydCB7IEdhbWVPYmplY3QgfSBmcm9tIFwiLi9nYW1lLW9iamVjdFwiO1xuaW1wb3J0IHsgU3R1bXBlZEdhbWVTZXR0aW5nc01hbmFnZXIgfSBmcm9tIFwiLi9nYW1lLXNldHRpbmdzXCI7XG5pbXBvcnQgeyBKb2IgfSBmcm9tIFwiLi9qb2JcIjtcbmltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuL3BsYXllclwiO1xuaW1wb3J0IHsgU3Bhd25lciB9IGZyb20gXCIuL3NwYXduZXJcIjtcbmltcG9ydCB7IFRpbGUgfSBmcm9tIFwiLi90aWxlXCI7XG5cbi8vIDw8LS0gQ3JlZXItTWVyZ2U6IGltcG9ydHMgLS0+PlxuXG5pbXBvcnQgeyBNdXRhYmxlIH0gZnJvbSBcIn4vdXRpbHNcIjtcbmltcG9ydCB7IGpvYlN0YXRzIH0gZnJvbSBcIi4vam9iLXN0YXRzXCI7XG5cbi8qKlxuICogQSB0aWxlIHRoYXQgY2FuIGJlIG11dGF0ZWQuIFNob3VsZCBvbmx5IGJlIHVzZWQgZHVyaW5nIGdhbWUgaW5pdGlhbGl6YXRpb24uXG4gKi9cbnR5cGUgTXV0YWJsZVRpbGUgPSBNdXRhYmxlPFRpbGU+O1xuXG4vLyA8PC0tIC9DcmVlci1NZXJnZTogaW1wb3J0cyAtLT4+XG5cbi8qKlxuICogR2F0aGVyIGJyYW5jaGVzIGFuZCBidWlsZCB1cCB5b3VyIGxvZGdlIGFzIGJlYXZlcnMgZmlnaHQgdG8gc3Vydml2ZS5cbiAqL1xuZXhwb3J0IGNsYXNzIFN0dW1wZWRHYW1lIGV4dGVuZHMgQmFzZUNsYXNzZXMuR2FtZSB7XG4gICAgLyoqIFRoZSBtYW5hZ2VyIG9mIHRoaXMgZ2FtZSwgdGhhdCBjb250cm9scyBldmVyeXRoaW5nIGFyb3VuZCBpdCAqL1xuICAgIHB1YmxpYyByZWFkb25seSBtYW5hZ2VyITogU3R1bXBlZEdhbWVNYW5hZ2VyO1xuXG4gICAgLyoqIFRoZSBzZXR0aW5ncyB1c2VkIHRvIGluaXRpYWxpemUgdGhlIGdhbWUsIGFzIHNldCBieSBwbGF5ZXJzICovXG4gICAgcHVibGljIHJlYWRvbmx5IHNldHRpbmdzID0gT2JqZWN0LmZyZWV6ZSh0aGlzLnNldHRpbmdzTWFuYWdlci52YWx1ZXMpO1xuXG4gICAgLyoqXG4gICAgICogRXZlcnkgQmVhdmVyIGluIHRoZSBnYW1lLlxuICAgICAqL1xuICAgIHB1YmxpYyBiZWF2ZXJzITogQmVhdmVyW107XG5cbiAgICAvKipcbiAgICAgKiBUaGUgcGxheWVyIHdob3NlIHR1cm4gaXQgaXMgY3VycmVudGx5LiBUaGF0IHBsYXllciBjYW4gc2VuZCBjb21tYW5kcy5cbiAgICAgKiBPdGhlciBwbGF5ZXJzIGNhbm5vdC5cbiAgICAgKi9cbiAgICBwdWJsaWMgY3VycmVudFBsYXllciE6IFBsYXllcjtcblxuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50IHR1cm4gbnVtYmVyLCBzdGFydGluZyBhdCAwIGZvciB0aGUgZmlyc3QgcGxheWVyJ3MgdHVybi5cbiAgICAgKi9cbiAgICBwdWJsaWMgY3VycmVudFR1cm4hOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBXaGVuIGEgUGxheWVyIGhhcyBsZXNzIEJlYXZlcnMgdGhhbiB0aGlzIG51bWJlciwgdGhlbiByZWNydWl0aW5nIG90aGVyXG4gICAgICogQmVhdmVycyBpcyBmcmVlLlxuICAgICAqL1xuICAgIHB1YmxpYyByZWFkb25seSBmcmVlQmVhdmVyc0NvdW50ITogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogQSBtYXBwaW5nIG9mIGV2ZXJ5IGdhbWUgb2JqZWN0J3MgSUQgdG8gdGhlIGFjdHVhbCBnYW1lIG9iamVjdC4gUHJpbWFyaWx5XG4gICAgICogdXNlZCBieSB0aGUgc2VydmVyIGFuZCBjbGllbnQgdG8gZWFzaWx5IHJlZmVyIHRvIHRoZSBnYW1lIG9iamVjdHMgdmlhXG4gICAgICogSUQuXG4gICAgICovXG4gICAgcHVibGljIGdhbWVPYmplY3RzIToge1tpZDogc3RyaW5nXTogR2FtZU9iamVjdH07XG5cbiAgICAvKipcbiAgICAgKiBBbGwgdGhlIEpvYnMgdGhhdCBCZWF2ZXJzIGNhbiBoYXZlIGluIHRoZSBnYW1lLlxuICAgICAqL1xuICAgIHB1YmxpYyBqb2JzITogSm9iW107XG5cbiAgICAvKipcbiAgICAgKiBDb25zdGFudCBudW1iZXIgdXNlZCB0byBjYWxjdWxhdGUgd2hhdCBpdCBjb3N0cyB0byBzcGF3biBhIG5ldyBsb2RnZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgcmVhZG9ubHkgbG9kZ2VDb3N0Q29uc3RhbnQhOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBIb3cgbWFueSBsb2RnZXMgbXVzdCBiZSBvd25lZCBieSBhIFBsYXllciBhdCBvbmNlIHRvIHdpbiB0aGUgZ2FtZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgcmVhZG9ubHkgbG9kZ2VzVG9XaW4hOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbnVtYmVyIG9mIFRpbGVzIGluIHRoZSBtYXAgYWxvbmcgdGhlIHkgKHZlcnRpY2FsKSBheGlzLlxuICAgICAqL1xuICAgIHB1YmxpYyByZWFkb25seSBtYXBIZWlnaHQhOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbnVtYmVyIG9mIFRpbGVzIGluIHRoZSBtYXAgYWxvbmcgdGhlIHggKGhvcml6b250YWwpIGF4aXMuXG4gICAgICovXG4gICAgcHVibGljIHJlYWRvbmx5IG1hcFdpZHRoITogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogVGhlIG1heGltdW0gbnVtYmVyIG9mIHR1cm5zIGJlZm9yZSB0aGUgZ2FtZSB3aWxsIGF1dG9tYXRpY2FsbHkgZW5kLlxuICAgICAqL1xuICAgIHB1YmxpYyByZWFkb25seSBtYXhUdXJucyE6IG51bWJlcjtcblxuICAgIC8qKlxuICAgICAqIExpc3Qgb2YgYWxsIHRoZSBwbGF5ZXJzIGluIHRoZSBnYW1lLlxuICAgICAqL1xuICAgIHB1YmxpYyBwbGF5ZXJzITogUGxheWVyW107XG5cbiAgICAvKipcbiAgICAgKiBBIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgZ2FtZSBpbnN0YW5jZSB0aGF0IGlzIGJlaW5nIHBsYXllZC5cbiAgICAgKi9cbiAgICBwdWJsaWMgcmVhZG9ubHkgc2Vzc2lvbiE6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIEV2ZXJ5IFNwYXduZXIgaW4gdGhlIGdhbWUuXG4gICAgICovXG4gICAgcHVibGljIHNwYXduZXIhOiBTcGF3bmVyW107XG5cbiAgICAvKipcbiAgICAgKiBDb25zdGFudCBudW1iZXIgdXNlZCB0byBjYWxjdWxhdGUgaG93IG1hbnkgYnJhbmNoZXMvZm9vZCBCZWF2ZXJzIGhhcnZlc3RcbiAgICAgKiBmcm9tIFNwYXduZXJzLlxuICAgICAqL1xuICAgIHB1YmxpYyByZWFkb25seSBzcGF3bmVySGFydmVzdENvbnN0YW50ITogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogQWxsIHRoZSB0eXBlcyBvZiBTcGF3bmVycyBpbiB0aGUgZ2FtZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgc3Bhd25lclR5cGVzITogc3RyaW5nW107XG5cbiAgICAvKipcbiAgICAgKiBBbGwgdGhlIHRpbGVzIGluIHRoZSBtYXAsIHN0b3JlZCBpbiBSb3ctbWFqb3Igb3JkZXIuIFVzZSBgeCArIHkgKlxuICAgICAqIG1hcFdpZHRoYCB0byBhY2Nlc3MgdGhlIGNvcnJlY3QgaW5kZXguXG4gICAgICovXG4gICAgcHVibGljIHRpbGVzITogVGlsZVtdO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGFtb3VudCBvZiB0aW1lIChpbiBuYW5vLXNlY29uZHMpIGFkZGVkIGFmdGVyIGVhY2ggcGxheWVyIHBlcmZvcm1zIGFcbiAgICAgKiB0dXJuLlxuICAgICAqL1xuICAgIHB1YmxpYyByZWFkb25seSB0aW1lQWRkZWRQZXJUdXJuITogbnVtYmVyO1xuXG4gICAgLy8gPDwtLSBDcmVlci1NZXJnZTogYXR0cmlidXRlcyAtLT4+XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbmV3bHkgc3Bhd25lZCBiZWF2ZXJzIHRoaXMgdHVybiB0aGF0IGFyZSBub3QgdHJhY2tlZCBpbiBhbnkgYXJyYXlzXG4gICAgICogKHlldCkuXG4gICAgICovXG4gICAgcHVibGljIHJlYWRvbmx5IG5ld0JlYXZlcnM6IEJlYXZlcltdID0gW107XG4gICAgLy8gPDwtLSAvQ3JlZXItTWVyZ2U6IGF0dHJpYnV0ZXMgLS0+PlxuXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIHdoZW4gYSBHYW1lIGlzIGNyZWF0ZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2V0dGluZ3NNYW5hZ2VyIC0gVGhlIG1hbmFnZXIgdGhhdCBob2xkcyBpbml0aWFsIHNldHRpbmdzLlxuICAgICAqIEBwYXJhbSByZXF1aXJlZCAtIERhdGEgcmVxdWlyZWQgdG8gaW5pdGlhbGl6ZSB0aGlzIChpZ25vcmUgaXQpLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcm90ZWN0ZWQgc2V0dGluZ3NNYW5hZ2VyOiBTdHVtcGVkR2FtZVNldHRpbmdzTWFuYWdlcixcbiAgICAgICAgcmVxdWlyZWQ6IFJlYWRvbmx5PElCYXNlR2FtZVJlcXVpcmVkRGF0YT4sXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKHNldHRpbmdzTWFuYWdlciwgcmVxdWlyZWQpO1xuXG4gICAgICAgIC8vIDw8LS0gQ3JlZXItTWVyZ2U6IGNvbnN0cnVjdG9yIC0tPj5cbiAgICAgICAgdGhpcy5zcGF3bmVyVHlwZXMucHVzaChcImJyYW5jaGVzXCIsIFwiZm9vZFwiKTtcblxuICAgICAgICBmb3IgKGNvbnN0IHRpdGxlIG9mIE9iamVjdC5rZXlzKGpvYlN0YXRzKS5zb3J0KCkpIHtcbiAgICAgICAgICAgIHRoaXMuam9icy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMubWFuYWdlci5jcmVhdGUuam9iKHtcbiAgICAgICAgICAgICAgICAgICAgLi4uam9iU3RhdHNbdGl0bGVdLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGNvbnN0IHBsYXllciBvZiB0aGlzLnBsYXllcnMpIHtcbiAgICAgICAgICAgIHBsYXllci5jYWxjdWxhdGVCcmFuY2hlc1RvQnVpbGRMb2RnZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5nZW5lcmF0ZU1hcCgpO1xuXG4gICAgICAgIC8vIDw8LS0gL0NyZWVyLU1lcmdlOiBjb25zdHJ1Y3RvciAtLT4+XG4gICAgfVxuXG4gICAgLy8gPDwtLSBDcmVlci1NZXJnZTogcHVibGljLWZ1bmN0aW9ucyAtLT4+XG5cbiAgICAvLyBBbnkgcHVibGljIGZ1bmN0aW9ucyBjYW4gZ28gaGVyZSBmb3Igb3RoZXIgdGhpbmdzIGluIHRoZSBnYW1lIHRvIHVzZS5cbiAgICAvLyBOT1RFOiBDbGllbnQgQUlzIGNhbm5vdCBjYWxsIHRoZXNlIGZ1bmN0aW9ucywgdGhvc2UgbXVzdCBiZSBkZWZpbmVkXG4gICAgLy8gaW4gdGhlIGNyZWVyIGZpbGUuXG5cbiAgICAvLyA8PC0tIC9DcmVlci1NZXJnZTogcHVibGljLWZ1bmN0aW9ucyAtLT4+XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB0aWxlIGF0ICh4LCB5KSwgb3IgdW5kZWZpbmVkIGlmIHRoZSBjby1vcmRpbmF0ZXMgYXJlIG9mZi1tYXAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0geCAtIFRoZSB4IHBvc2l0aW9uIG9mIHRoZSBkZXNpcmVkIHRpbGUuXG4gICAgICogQHBhcmFtIHkgLSBUaGUgeSBwb3NpdGlvbiBvZiB0aGUgZGVzaXJlZCB0aWxlLlxuICAgICAqIEByZXR1cm5zIFRoZSBUaWxlIGF0ICh4LCB5KSBpZiB2YWxpZCwgdW5kZWZpbmVkIG90aGVyd2lzZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0VGlsZSh4OiBudW1iZXIsIHk6IG51bWJlcik6IFRpbGUgfCB1bmRlZmluZWQge1xuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tdW5zYWZlLWFueVxuICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VGlsZSh4LCB5KSBhcyBUaWxlIHwgdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8vIDw8LS0gQ3JlZXItTWVyZ2U6IHByb3RlY3RlZC1wcml2YXRlLWZ1bmN0aW9ucyAtLT4+XG5cbiAgICAvKiogR2VuZXJhdGVzIHRoZSBtYXAsIGJ5IG1vZGlmeWluZyB0aWxlcyBhdHRyaWJ1dGVzLiAqL1xuICAgIHByaXZhdGUgZ2VuZXJhdGVNYXAoKTogdm9pZCB7XG4gICAgICAgIC8vIExha2UgY2VudGVyXG4gICAgICAgIGNvbnN0IGxha2UgPSBNYXRoLmZsb29yKHRoaXMubWFwV2lkdGggLyAyKTtcblxuICAgICAgICAvLyBHZW5lcmF0ZSByYW5kb20gbWV0YWJhbGxzIHdoZXJlIHRoZSBsYWtlIHdpbGwgYmVcbiAgICAgICAgY29uc3QgYmFsbHM6IEFycmF5PHtcbiAgICAgICAgICAgIC8qKiBYIHBvc2l0aW9uIG9mIHRoZSBiYWxsICovXG4gICAgICAgICAgICB4OiBudW1iZXI7XG4gICAgICAgICAgICAvKiogWSBwb3NpdGlvbiBvZiB0aGUgYmFsbCAqL1xuICAgICAgICAgICAgeTogbnVtYmVyO1xuICAgICAgICAgICAgLyoqIFJhZGl1cyBvZiB0aGUgYmFsbCAqL1xuICAgICAgICAgICAgcjogbnVtYmVyO1xuICAgICAgICB9PiA9IFtdO1xuICAgICAgICBjb25zdCBtaW5SYWRpdXMgPSAwLjU7XG4gICAgICAgIGNvbnN0IG1heFJhZGl1cyA9IDUuMDtcbiAgICAgICAgY29uc3QgbWF4T2Zmc2V0ID0gMi4wO1xuICAgICAgICBjb25zdCBhZGRpdGlvbmFsQmFsbHMgPSA1O1xuICAgICAgICBjb25zdCBnb29leU5lc3MgPSAxLjA7XG4gICAgICAgIGNvbnN0IHRocmVzaG9sZCA9IDMuNTtcbiAgICAgICAgY29uc3QgcmFkaXVzUmFuZ2UgPSBtYXhSYWRpdXMgLSBtaW5SYWRpdXM7XG5cbiAgICAgICAgLy8gSW5pdGlhbCBiYWxsIChsYWtlIGNlbnRlcilcbiAgICAgICAgYmFsbHMucHVzaCh7XG4gICAgICAgICAgICB4OiBsYWtlLFxuICAgICAgICAgICAgeTogdGhpcy5tYXBIZWlnaHQgLyAyLFxuICAgICAgICAgICAgcjogdGhpcy5tYW5hZ2VyLnJhbmRvbS5mbG9hdCgpICogcmFkaXVzUmFuZ2UgKyBtaW5SYWRpdXMsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEV4dHJhIGJhbGxzXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWRkaXRpb25hbEJhbGxzOyBpKyspIHtcbiAgICAgICAgICAgIGJhbGxzLnB1c2goe1xuICAgICAgICAgICAgICAgIHg6IGxha2UgKyB0aGlzLm1hbmFnZXIucmFuZG9tLmZsb2F0KCkgKiBtYXhPZmZzZXQgKiAyIC0gbWF4T2Zmc2V0LFxuICAgICAgICAgICAgICAgIHk6IHRoaXMubWFwSGVpZ2h0IC8gMiAtIHRoaXMubWFuYWdlci5yYW5kb20uZmxvYXQoKSAqIG1heE9mZnNldCxcbiAgICAgICAgICAgICAgICByOiB0aGlzLm1hbmFnZXIucmFuZG9tLmZsb2F0KCkgKiByYWRpdXNSYW5nZSArIG1pblJhZGl1cyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgbGFrZSBmcm9tIG1ldGFiYWxsc1xuICAgICAgICBmb3IgKGNvbnN0IHRpbGUgb2YgdGhpcy50aWxlcykge1xuICAgICAgICAgICAgbGV0IGVuZXJneSA9IDA7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGJhbGwgb2YgYmFsbHMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gYmFsbC5yO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoTWF0aC5wb3coYmFsbC54IC0gdGlsZS54LCAyKSArIE1hdGgucG93KGJhbGwueSAtIHRpbGUueSwgMikpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGQgPSBNYXRoLm1heCgwLjAwMDEsIE1hdGgucG93KGRpc3QsIGdvb2V5TmVzcykpO1xuICAgICAgICAgICAgICAgIGVuZXJneSArPSByIC8gZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGVuZXJneSA+IHRocmVzaG9sZCkge1xuICAgICAgICAgICAgICAgICh0aWxlIGFzIE11dGFibGVUaWxlKS50eXBlID0gXCJ3YXRlclwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyogR2VuZXJhdGUgcml2ZXJzICovXG4gICAgICAgIGNvbnN0IG1pblRoZXRhID0gTWF0aC5QSSAvIDQ7XG4gICAgICAgIGNvbnN0IG1heFRoZXRhID0gTWF0aC5QSSAqIDMgLyA0O1xuICAgICAgICBjb25zdCBtaW5UaGV0YURlbHRhID0gTWF0aC5QSSAvIDY7XG4gICAgICAgIGNvbnN0IG1heFRoZXRhRGVsdGEgPSBNYXRoLlBJIC8gNDtcbiAgICAgICAgY29uc3QgdGhldGFEZWx0YVJhbmdlID0gbWF4VGhldGFEZWx0YSAtIG1pblRoZXRhRGVsdGE7XG5cbiAgICAgICAgbGV0IHRoZXRhID0gbWluVGhldGEgLSBtaW5UaGV0YURlbHRhO1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgdGhldGEgKz0gdGhpcy5tYW5hZ2VyLnJhbmRvbS5mbG9hdCgpICogdGhldGFEZWx0YVJhbmdlICsgbWluVGhldGFEZWx0YTtcbiAgICAgICAgICAgIGlmICh0aGV0YSA+PSBtYXhUaGV0YSkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYEdlbmVyYXRpbmcgcml2ZXIgYXQgJHt0aGV0YSAqIDE4MCAvIE1hdGguUEl9IGRlZ3JlZXNgKTtcblxuICAgICAgICAgICAgLy8gRGVmaW5lIHRoZSBsaW5lIHNlZ21lbnRzXG4gICAgICAgICAgICBjb25zdCBwb2ludHM6IEFycmF5PHtcbiAgICAgICAgICAgICAgICAvKiogWCBwb3NpdGlvbiAqL1xuICAgICAgICAgICAgICAgIHg6IG51bWJlcjtcbiAgICAgICAgICAgICAgICAvKiogWSBwb3NpdG9pb24gKi9cbiAgICAgICAgICAgICAgICB5OiBudW1iZXI7XG4gICAgICAgICAgICB9PiA9IFtdO1xuXG4gICAgICAgICAgICAvLyBTdGFydGluZyBwb2ludCAtIFRoZSBjZW50ZXIgb2YgbGFrZSwgYXQgKDAsIDApXG4gICAgICAgICAgICBwb2ludHMucHVzaCh7XG4gICAgICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIEZpbmFsIHBvaW50IC0gT3V0c2lkZSB0aGUgZWRnZSBvZiB0aGUgbWFwXG4gICAgICAgICAgICBwb2ludHMucHVzaCh7XG4gICAgICAgICAgICAgICAgeDogdGhpcy5tYXBXaWR0aCArIHRoaXMubWFwSGVpZ2h0LFxuICAgICAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gR2VuZXJhdGUgZnJhY3RhbHNcbiAgICAgICAgICAgIC8vIGNyZWF0ZUZyYWN0YWwocG9pbnRzLCAwLCAxKTtcblxuICAgICAgICAgICAgLy8gVHJhbnNmb3JtIHBvaW50c1xuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gTWF0aC5QSTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcCBvZiBwb2ludHMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gTWF0aC5zcXJ0KHAueCAqIHAueCArIHAueSAqIHAueSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IE1hdGguYXRhbjIocC55LCBwLngpICsgdGhldGEgKyBvZmZzZXQ7XG4gICAgICAgICAgICAgICAgcC54ID0gbGFrZSArIHIgKiBNYXRoLmNvcyh0KTtcbiAgICAgICAgICAgICAgICBwLnkgPSB0aGlzLm1hcEhlaWdodCAvIDIgKyByICogTWF0aC5zaW4odCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiUG9pbnRzOlwiKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHBvaW50cyk7XG5cbiAgICAgICAgICAgIC8vIERyYXcgbGluZSBzZWdtZW50c1xuICAgICAgICAgICAgbGV0IGNvbGxpZGVkID0gZmFsc2U7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgIWNvbGxpZGVkICYmIGkgPCBwb2ludHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhID0gcG9pbnRzW2kgLSAxXTtcbiAgICAgICAgICAgICAgICBjb25zdCBiID0gcG9pbnRzW2ldO1xuXG4gICAgICAgICAgICAgICAgLy8gVXNlZnVsIHZhbHVlc1xuICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0gYi54IC0gYS54O1xuICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0gYi55IC0gYS55O1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0ZXBzID0gTWF0aC5tYXgoTWF0aC5hYnMoZHgpLCBNYXRoLmFicyhkeSkpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgeEluYyA9IGR4IC8gc3RlcHM7XG4gICAgICAgICAgICAgICAgY29uc3QgeUluYyA9IGR5IC8gc3RlcHM7XG5cbiAgICAgICAgICAgICAgICBsZXQgYXggPSBhLng7XG4gICAgICAgICAgICAgICAgbGV0IGF5ID0gYS55O1xuICAgICAgICAgICAgICAgIGxldCBsYXN0WCA9IC0xO1xuICAgICAgICAgICAgICAgIGxldCBsYXN0WSA9IC0xO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IHN0ZXAgPSAwOyAhY29sbGlkZWQgJiYgc3RlcCA8IHN0ZXBzOyBzdGVwKyspIHtcbiAgICAgICAgICAgICAgICAgICAgYXggKz0geEluYztcbiAgICAgICAgICAgICAgICAgICAgYXkgKz0geUluYztcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVhbFggPSBNYXRoLmZsb29yKGF4KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVhbFkgPSBNYXRoLmZsb29yKGF5KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dFggPSBNYXRoLmZsb29yKGF4ICsgeEluYyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRZID0gTWF0aC5mbG9vcihheSArIHlJbmMpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFZlcmlmeSB0aGUgY3VycmVudCB0aWxlIGV4aXN0c1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVhbFggPj0gMCAmJiByZWFsWSA+PSAwICYmIHJlYWxYIDwgdGhpcy5tYXBXaWR0aCAmJiByZWFsWSA8IHRoaXMubWFwSGVpZ2h0IC8gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRpbGUgdG8gd2F0ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbGUgPSB0aGlzLmdldFRpbGUocmVhbFgsIHJlYWxZKSBhcyBNdXRhYmxlVGlsZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgZ28gZGlhZ29uYWxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFsWCAhPT0gbmV4dFggJiYgcmVhbFkgIT09IG5leHRZKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXkgLT0geUluYztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmxvdyBkaXJlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aWxlLnR5cGUgIT09IFwid2F0ZXJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFsWSA+IGxhc3RZKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbGUuZmxvd0RpcmVjdGlvbiA9IFwiTm9ydGhcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVhbFkgPCBsYXN0WSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWxlLmZsb3dEaXJlY3Rpb24gPSBcIlNvdXRoXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlYWxYIDwgbGFzdFgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlsZS5mbG93RGlyZWN0aW9uID0gXCJFYXN0XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlYWxYID4gbGFzdFgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlsZS5mbG93RGlyZWN0aW9uID0gXCJXZXN0XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlsZS50eXBlID0gXCJ3YXRlclwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGlsZS5mbG93RGlyZWN0aW9uICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGxhc3QgY29vcmRzXG4gICAgICAgICAgICAgICAgICAgIGxhc3RYID0gcmVhbFg7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RZID0gcmVhbFk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gY3JlYXRlIHNwYXduZXJzXG4gICAgICAgIGZvciAoY29uc3QgdHlwZSBvZiB0aGlzLnNwYXduZXJUeXBlcyBhcyBbXCJicmFuY2hlc1wiLCBcImZvb2RcIl0pIHtcbiAgICAgICAgICAgIGNvbnN0IG1heCA9IHR5cGUgPT09IFwiYnJhbmNoZXNcIlxuICAgICAgICAgICAgICAgID8gdGhpcy5zZXR0aW5ncy5tYXhCcmFuY2hTcGF3bmVyc1xuICAgICAgICAgICAgICAgIDogdGhpcy5zZXR0aW5ncy5tYXhGb29kU3Bhd25lcnM7XG4gICAgICAgICAgICBjb25zdCBtaW4gPSB0eXBlID09PSBcImJyYW5jaGVzXCJcbiAgICAgICAgICAgICAgICA/IHRoaXMuc2V0dGluZ3MubWluQnJhbmNoU3Bhd25lcnNcbiAgICAgICAgICAgICAgICA6IHRoaXMuc2V0dGluZ3MubWluRm9vZFNwYXduZXJzO1xuXG4gICAgICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMubWFuYWdlci5yYW5kb20uaW50KG1heCwgbWluKTtcbiAgICAgICAgICAgIGNvbnN0IHRpbGVUeXBlID0gdHlwZSA9PT0gXCJmb29kXCIgPyBcIndhdGVyXCIgOiBcImxhbmRcIjtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IHRpbGU6IFRpbGUgfCB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgd2hpbGUgKCF0aWxlIHx8IHRpbGUudHlwZSAhPT0gdGlsZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2VuZXJhdGUgYSBuZXcgdGlsZSB0byBzZWUgaWYgaXQgaXMgdmFsaWRcbiAgICAgICAgICAgICAgICAgICAgdGlsZSA9IHRoaXMuZ2V0VGlsZShcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWFuYWdlci5yYW5kb20uaW50KHRoaXMubWFwV2lkdGggLSAxKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWFuYWdlci5yYW5kb20uaW50KHRoaXMubWFwSGVpZ2h0IC8gMiAtIDEpLFxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMubWFuYWdlci5jcmVhdGUuc3Bhd25lcih7IHRpbGUsIHR5cGUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKiBNaXJyb3IgbWFwICovXG4gICAgICAgIGZvciAoY29uc3Qgb3JpZyBvZiB0aGlzLnRpbGVzKSB7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLmdldFRpbGUob3JpZy54LCB0aGlzLm1hcEhlaWdodCAtIG9yaWcueSAtIDEpIGFzIE11dGFibGVUaWxlO1xuXG4gICAgICAgICAgICAvLyBDb3B5IGRhdGFcbiAgICAgICAgICAgIHRhcmdldC50eXBlID0gb3JpZy50eXBlO1xuICAgICAgICAgICAgdGFyZ2V0LmZsb3dEaXJlY3Rpb24gPSAob3JpZy5mbG93RGlyZWN0aW9uID09PSBcIk5vcnRoXCIgfHwgb3JpZy5mbG93RGlyZWN0aW9uID09PSBcIlNvdXRoXCIpXG4gICAgICAgICAgICAgICAgPyB0aGlzLmludmVydFRpbGVEaXJlY3Rpb24ob3JpZy5mbG93RGlyZWN0aW9uKVxuICAgICAgICAgICAgICAgIDogb3JpZy5mbG93RGlyZWN0aW9uO1xuXG4gICAgICAgICAgICAvLyBjbG9uZSBTcGF3bmVyXG4gICAgICAgICAgICBpZiAob3JpZy5zcGF3bmVyKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LnNwYXduZXIgPSB0aGlzLm1hbmFnZXIuY3JlYXRlLnNwYXduZXIoe1xuICAgICAgICAgICAgICAgICAgICB0aWxlOiB0YXJnZXQgYXMgVGlsZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogb3JpZy5zcGF3bmVyLnR5cGUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKiBQbGFjZSBzdGFydGluZyBiZWF2ZXJzICovXG4gICAgICAgIGxldCBwMTogVGlsZSB8IHVuZGVmaW5lZDtcbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgcDEgPSB0aGlzLmdldFRpbGUoXG4gICAgICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLnJhbmRvbS5pbnQodGhpcy5tYXBXaWR0aCksXG4gICAgICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLnJhbmRvbS5pbnQodGhpcy5tYXBIZWlnaHQgLyAyKSxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmICghcDEpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjb3VsZCBub3QgZ2V0IHJhbmRvbSB0aWxlIGZyb20gZXhwZWN0ZWQgbWFwIGRpbWVuc2lvbnMhXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IHdoaWxlIChwMS5zcGF3bmVyKTtcblxuICAgICAgICBjb25zdCBwMiA9IHRoaXMuZ2V0VGlsZShwMS54LCB0aGlzLm1hcEhlaWdodCAtIHAxLnkgLSAxKTtcblxuICAgICAgICBpZiAoIXAyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjb3VsZCBub3QgZ2V0IG1pcnJvcmVkIHN0YXJ0aW5nIHRpbGUgZm9yIHBsYXllciAyIVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFBsYXllciAxXG4gICAgICAgIHRoaXMubWFuYWdlci5jcmVhdGUuYmVhdmVyKHtcbiAgICAgICAgICAgIG93bmVyOiB0aGlzLnBsYXllcnNbMF0sXG4gICAgICAgICAgICB0aWxlOiBwMSxcbiAgICAgICAgICAgIGpvYjogdGhpcy5qb2JzWzBdLFxuICAgICAgICAgICAgcmVjcnVpdGVkOiB0cnVlLFxuICAgICAgICAgICAgYnJhbmNoZXM6IDEsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFBsYXllciAyXG4gICAgICAgIHRoaXMubWFuYWdlci5jcmVhdGUuYmVhdmVyKHtcbiAgICAgICAgICAgIG93bmVyOiB0aGlzLnBsYXllcnNbMV0sXG4gICAgICAgICAgICB0aWxlOiBwMixcbiAgICAgICAgICAgIGpvYjogdGhpcy5qb2JzWzBdLFxuICAgICAgICAgICAgcmVjcnVpdGVkOiB0cnVlLFxuICAgICAgICAgICAgYnJhbmNoZXM6IDEsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMubWFuYWdlci5jbGVhbnVwQXJyYXlzKCk7XG4gICAgfVxuXG4gICAgLy8gPDwtLSAvQ3JlZXItTWVyZ2U6IHByb3RlY3RlZC1wcml2YXRlLWZ1bmN0aW9ucyAtLT4+XG59XG4iXX0=